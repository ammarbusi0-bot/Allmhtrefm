// *** 1. قاعدة بيانات 100 سؤال (الاختيار المتعدد) ***
const ALL_QUESTIONS_DATA = [
    {q: "في الفقه الإسلامي، ما هو الحكم الشرعي لبيع 'العِينة'؟", a: ["حرام", "جائز بشروط", "مكروه", "مباح"], correct: 0, info: "بيع العينة هو بيع السلعة بثمن مؤجل ثم شراؤها نقداً بثمن أقل، وهو حيلة للربا، وحكمه التحريم عند جمهور الفقهاء."},
    {q: "ما هو أقل النصاب الذي تجب فيه زكاة الذهب؟", a: ["20 مثقالاً (حوالي 85 جراماً)", "10 مثاقيل", "30 مثقالاً", "50 جراماً"], correct: 0, info: "نصاب الذهب 20 مثقالاً، ويعادل تقريباً 85 جراماً من الذهب الخالص (عيار 24)، وتجب فيه الزكاة بمقدار 2.5%."},
    {q: "ما هي الفترة الزمنية التي يُشرع فيها للمسافر أن يمسح على خفيه أو جوربيه؟", a: ["ثلاثة أيام بلياليها", "يوم وليلة", "خمسة أيام بلياليها", "أسبوع كامل"], correct: 0, info: "المسافر له أن يمسح على الخفين أو الجوربين لمدة ثلاثة أيام بلياليها (72 ساعة)."},
    {q: "في أي ركعة من صلاة الوتر يشرع قراءة دعاء القنوت؟", a: ["الركعة الأخيرة قبل الركوع", "الركعة الأخيرة بعد الركوع", "الركعة الأولى", "بعد السلام من الصلاة"], correct: 1, info: "يشرع دعاء القنوت في الركعة الأخيرة من صلاة الوتر بعد الرفع من الركوع (عند الشافعية والحنابلة)، وقبله (عند الأحناف)."},
    {q: "ما حكم إخراج زكاة الفطر قيمة نقدية (مالاً) بدلاً من الطعام؟", a: ["جائز عند الحنفية", "غير جائز باتفاق المذاهب", "جائز عند المالكية فقط", "مكروه"], correct: 0, info: "يجوز إخراج زكاة الفطر نقداً (مالاً) بدلاً من الطعام عند الحنفية وبعض الفقهاء المعاصرين، وهو خلاف مذهب الجمهور."},
    {q: "ما هو الحد الأدنى لوقت الحيض الذي تعتد به المرأة شرعاً؟", a: ["يوم وليلة", "ثلاثة أيام", "ساعة واحدة", "لا حد لأقله"], correct: 1, info: "أقل الحيض يوم وليلة عند بعض الفقهاء، بينما يرى آخرون (كالأحناف) أن أقله ثلاثة أيام بلياليها."},
    {q: "ما هي الشروط الأساسية لصحة عقد البيع في الفقه؟", a: ["الرضا والمعلومية والقدرة على التسليم", "توثيق العقد بالكتابة", "وجود شهود على البيع", "دفع الثمن كاملاً فوراً"], correct: 0, info: "من الشروط الأساسية لصحة البيع: التراضي بين البائع والمشتري، وأن يكون المبيع والثمن معلومين، والقدرة على تسليم المبيع."},
    {q: "ما الحكم الفقهي لمن حلف يميناً ثم حنث فيه؟", a: ["وجبت عليه الكفارة", "يستغفر الله فقط", "يصوم ثلاثة أيام دون كفارة", "لا شيء عليه"], correct: 0, info: "إذا حنث في يمينه، وجبت عليه كفارة اليمين: إطعام عشرة مساكين أو كسوتهم أو تحرير رقبة، فمن لم يجد فصيام ثلاثة أيام."},
    {q: "ما الحكم الفقهي للعاقد الذي يعلم الغبن (الضرر الفاحش) على الطرف الآخر؟", a: ["البيع صحيح مع الإثم", "البيع باطل", "البيع موقوف على إجازة القاضي", "البيع مكروه"], correct: 0, info: "البيع صحيح ولكنه يأثم إذا كان يعلم بالغبن، وللمغبون حق الفسخ عند بعض الفقهاء."},
    {q: "ماذا يُقصد بـ 'المُصرّاة' في الفقه المتعلق بعيوب المبيع؟", a: ["التي حبس لبنها لتظهر أنها كثيرة الحليب", "التي اشتريت بسعر مبالغ فيه", "التي تحمل أكثر من حمل", "التي فيها عيب خلقي"], correct: 0, info: "المصرّاة هي البهيمة التي تُحبس ضرعها عن الحلب أياماً قبل البيع ليظن المشتري أن لبنها كثير. وللمشتري الخيار بردّها مع صاع من تمر."},
    {q: "كم هي المدة التي تُعفى فيها الإبل السائمة من الزكاة قبل أن يتم حولها؟", a: ["لا شيء يُعفى منها", "6 أشهر", "9 أشهر", "3 أشهر"], correct: 0, info: "لا يوجد إعفاء زمني؛ إذا بلغت النصاب وحال عليها الحول، وجبت الزكاة فيها."},
    {q: "ما حكم تيمم الجُنُب إذا لم يجد الماء للصلاة؟", a: ["التيمم صحيح ويصلي", "لا يجوز له التيمم إلا بعد مرور وقت الصلاة", "يؤخر الصلاة حتى يجد الماء", "يتيمم ويقضي بعد ذلك"], correct: 0, info: "التيمم يرفع الحدث الأكبر والأصغر عند فقد الماء أو العجز عن استعماله، والتيمم صحيح ويصلي."},
    {q: "ماذا يُقصد بـ 'نَفْقة المُتعة' في الطلاق؟", a: ["ما يعطى للزوجة تعويضاً لجبرها بعد الطلاق", "ما تدفعه الزوجة للزوج مقابل الخُلع", "المتعة في فترة العدة", "نفقة الأطفال بعد الطلاق"], correct: 0, info: "نفقة المتعة هي مال يدفعه الزوج للمرأة المطلقة لجبر خاطرها، وهي واجبة عند بعض الفقهاء للمطلقة قبل الدخول، وعند آخرين للمطلقة التي لم تُفرض لها نفقة."},
    {q: "ما هو الحد الأدنى لعدد الأشخاص لصحة صلاة الجمعة عند الجمهور (غير الحنابلة)؟", a: ["أربعون", "اثنا عشر", "اثنان", "ثلاثة"], correct: 0, info: "يشترط لصحة الجمعة عند الشافعية والمالكية عدد معين من الرجال الأحرار البالغين، وغالباً يحدد بأربعين رجلاً."},
    {q: "ما هو 'التأبيد' في باب النكاح؟", a: ["الاشتراط على الزوجين عدم الطلاق أبداً", "اشتراط الزواج المؤقت بمدة معينة", "الاشتراط على الزوجة عدم الزواج بعد الطلاق", "نية استمرار الزواج دون تحديد مدة"], correct: 3, info: "النية التي يجب أن تتوفر في عقد النكاح بأن يكون لغرض الدوام والاستمرار، بخلاف نية التوقيت (نكاح المتعة) وهو باطل."},
    {q: "ما هي السورة التي بدأت بالحمد واختُتمت به أيضاً؟", a: ["سورة الفاتحة", "سورة الإسراء", "سورة الكهف", "سورة سبأ"], correct: 2, info: "سورة الكهف هي التي بدأت بـ (الحمد لله الذي أنزل على عبده الكتاب) واختُتمت بـ (فلله الحمد رب السماوات ورب الأرض رب العالمين)."},
    {q: "ما هو الشيء الذي يحرم بيعه قبل قبضه في الشريعة الإسلامية؟", a: ["الطعام (المكيل والموزون)", "العقار", "الذهب والفضة", "الملابس المصنوعة يدوياً"], correct: 0, info: "يحرم بيع الطعام المكيل والموزون قبل قبضه؛ لحديث النبي ﷺ: 'من ابتاع طعاماً فلا يبعه حتى يقبضه'."},
    {q: "ما الحكم إذا نوى الإمام والمنفرد الصوم في الليل، ثم أفاق الإمام قبل الفجر ونوى الإفطار، فهل يصح صوم المنفرد؟", a: ["يصح صوم المنفرد", "لا يصح ويجب عليه القضاء", "يجب عليه أن يجدد النية بعد الفجر", "يصوم ذلك اليوم تطوعاً"], correct: 0, info: "نية كل مكلف مستقلة عن الآخر، وصوم المنفرد صحيح ما دام قد نوى الصوم قبل الفجر."},
    {q: "من هو 'حبر الأمة وترجمان القرآن' من الصحابة؟", a: ["عبد الله بن عباس", "عبد الله بن عمر", "أنس بن مالك", "معاذ بن جبل"], correct: 0, info: "هو الصحابي الجليل عبد الله بن عباس رضي الله عنهما، دعا له النبي ﷺ بالفهم في الدين والتأويل."},
    {q: "ما هو الفرق الرئيسي بين 'الواجب' و 'الفرض' عند جمهور الفقهاء؟", a: ["هما مترادفان ولا فرق بينهما", "الواجب أقل تأكيداً من الفرض", "الفرض ما ثبت بدليل قطعي والواجب بدليل ظني", "الواجب يتعلق بالبدن والفرض بالمال"], correct: 2, info: "الفرض ما ثبت بدليل قطعي لا شبهة فيه، والواجب ما ثبت بدليل ظني يحتمل التأويل. هذا التفريق هو مذهب الحنفية، بينما يرى الجمهور أنهما مترادفان."},
    {q: "في أي سنة هجرية وقعت غزوة أحد؟", a: ["السنة الثالثة للهجرة", "السنة الخامسة للهجرة", "السنة السابعة للهجرة", "السنة الرابعة للهجرة"], correct: 0, info: "وقعت غزوة أحد في شوال من السنة الثالثة للهجرة."},
    {q: "كم كان عدد الصحابة الذين بايعوا النبي ﷺ في بيعة الرضوان؟", a: ["حوالي 1400 صحابي", "ألف صحابي", "ثلاثمائة وثلاثة عشر", "سبعون صحابياً"], correct: 0, info: "كان عدد الصحابة الذين بايعوا النبي تحت الشجرة في الحديبية حوالي 1400 صحابي."},
    {q: "من هو الخليفة الذي أمر بجمع القرآن الكريم في مصحف واحد بعد وفاة النبي ﷺ؟", a: ["أبو بكر الصديق", "عمر بن الخطاب", "عثمان بن عفان", "علي بن أبي طالب"], correct: 0, info: "أبو بكر الصديق هو من أمر بجمع القرآن بعد استشارة عمر بن الخطاب، بسبب كثرة استشهاد القراء في حروب الردة."},
    {q: "ما هي المدينة التي كانت عاصمة الدولة الأموية؟", a: ["دمشق", "بغداد", "المدينة المنورة", "القاهرة"], correct: 0, info: "كانت دمشق عاصمة الخلافة الأموية."},
    {q: "من هو أول من قاد فتوحات المسلمين في بلاد السند؟", a: ["محمد بن القاسم الثقفي", "قُتيبة بن مسلم الباهلي", "طارق بن زياد", "عقبة بن نافع"], correct: 0, info: "محمد بن القاسم الثقفي قاد الفتوحات إلى السند (باكستان حالياً) في عهد الوليد بن عبد الملك."},
    {q: "ما هو الحكم إذا شك المصلي في عدد الركعات هل صلى ثلاثاً أم أربعاً؟", a: ["يبني على الأقل (ثلاث) ويسجد للسهو", "يبني على الأكثر (أربع)", "يقطع الصلاة ويعيدها", "يخير بين الأخذ بأي عدد"], correct: 0, info: "يبني على اليقين وهو الأقل (ثلاث)، ويأتي بالركعة الناقصة، ويسجد للسهو بعد السلام (مذهب الشافعية والحنابلة)."},
    {q: "ما هو أقل مهر يجب أن يُسمّى للمرأة في عقد النكاح؟", a: ["لا حد لأقله", "دينار ذهبي واحد", "ثلاثة دراهم فضية", "عشرة دراهم"], correct: 0, info: "جمهور الفقهاء (كالشافعية والحنابلة) يرون أنه لا حد لأقله، فكل ما يصح أن يكون مبيعاً صح أن يكون مهراً."},
    {q: "ماذا يُقصد بـ 'التولية' في البيوع؟", a: ["البيع برأس المال دون ربح أو خسارة", "البيع برأس المال مع ربح معلوم", "البيع بسعر أقل من سعر السوق", "البيع مع تحديد أجل للدفع"], correct: 0, info: "التولية هي بيع السلعة بثمنها الأصلي الذي اشتراها به البائع (برأس المال) دون زيادة ربح أو خسارة."},
    {q: "متى يجوز للمحرم بالحج أو العمرة قتل الصيد؟", a: ["لا يجوز له القتل أبداً", "إذا كان الصيد مؤذياً", "إذا كان صيداً بحرياً", "إذا كان المحرم مضطراً للأكل"], correct: 2, info: "يحرم على المحرم صيد البر، أما صيد البحر فيجوز له قتله وأكله لقوله تعالى: 'أحل لكم صيد البحر وطعامه متاعاً لكم وللسيارة'."},
    {q: "ماذا يُسمى الإجماع الذي ينعقد بقول بعض المجتهدين وسكوت الباقين؟", a: ["الإجماع السكوتي", "الإجماع الصريح", "الإجماع القياسي", "الإجماع الحسي"], correct: 0, info: "هو الإجماع السكوتي، وحجيته مختلف فيها بين الفقهاء."},
    {q: "ما هو المصطلح الفقهي الذي يطلق على إجازة العقد الناقص من قبل من يملك الإجازة؟", a: ["العقد الموقوف", "العقد الباطل", "العقد الفاسد", "العقد اللازم"], correct: 0, info: "هو العقد الموقوف، مثل بيع الفضولي، والذي يتوقف نفاذه على إجازة المالك."},
    {q: "ما هو الحد الأدنى للنصاب الذي تجب فيه زكاة الفضة؟", a: ["مائتا درهم (595 جراماً تقريباً)", "عشرة دراهم", "خمسون درهماً", "ألف جرام"], correct: 0, info: "نصاب الفضة هو مائتا درهم، أي ما يعادل 595 جراماً من الفضة الخالصة."},
    {q: "ما هي المدة التي يجب على المطلقة ثلاثاً أن تعتد بها؟", a: ["حتى تنكح زوجاً غيره", "ثلاث حيضات", "أربعة أشهر وعشرة أيام", "سنة كاملة"], correct: 0, info: "المطلقة ثلاثاً لا يجوز لها الرجوع إلى مطلقها إلا بعد أن تتزوج زوجاً آخر زواجاً صحيحاً ويطلقها بعد الدخول (المحلل الشرعي)."},
    {q: "من هو أول خليفة عباسي؟", a: ["أبو العباس السفاح", "هارون الرشيد", "المنصور", "ال مأمون"], correct: 0, info: "هو أبو العباس عبد الله السفاح، وأُعلن قيام الدولة العباسية عام 132 هـ."},
    {q: "ما اسم المعركة التي هزم فيها المسلمون الروم وفتحت الطريق أمام فتوحات الشام؟", a: ["اليرموك", "القادسية", "عين جالوت", "حطين"], correct: 0, info: "معركة اليرموك (15 هـ) كانت من أكبر المعارك الفاصلة لفتح الشام."},
    {q: "في عهد من من الخلفاء الراشدين تم تدوين الدواوين (السجلات الحكومية) وإنشاء نظام البريد؟", a: ["عمر بن الخطاب", "عثمان بن عفان", "علي بن أبي طالب", "أبو بكر الصديق"], correct: 0, info: "في عهد عمر بن الخطاب رضي الله عنه تم تنظيم الدواوين (مثل ديوان العطاء والجند)."},
    {q: "ما هو الحكم الشرعي لزيادة الثمن مقابل الأجل في البيع (التقسيط)؟", a: ["جائز (بيوع الأجل)", "مكروه", "حرام (ربا)", "مباح بشرطين"], correct: 0, info: "جائز شرعاً عند جمهور الفقهاء، بشرط تحديد الثمن الإجمالي للعقد بوضوح وقت إبرامه."},
    {q: "ما هو المصطلح الفقهي الذي يطلق على المال الذي يدفع للزوجة في عقد النكاح؟", a: ["المهر (أو الصداق)", "النفقة", "المتعة", "الكفارة"], correct: 0, info: "المهر أو الصداق هو ما يجب للمرأة على زوجها بمجرد العقد."},
    {q: "ما حكم صلاة المنفرد خلف الصف عند جمهور الفقهاء؟", a: ["باطلة", "صحيحة مع الكراهة", "صحيحة بلا كراهة", "موقوفة على إعادة الصلاة"], correct: 0, info: "عند الحنابلة والشافعية، صلاة المنفرد خلف الصف باطلة إلا لعذر."},
    {q: "ماذا يعني 'ربا الفضل'؟", a: ["الزيادة في جنس واحد من الأموال الربوية", "تأخير قبض المال الربوي", "البيع بثمن مؤجل", "بيع سلعة لم تقبض بعد"], correct: 0, info: "ربا الفضل هو مبادلة مال ربوي بمال ربوي من نفس الجنس مع زيادة (مثل بيع صاع قمح بصاعين قمح)."},
    {q: "من هو الصحابي الذي أشار على النبي ﷺ بحفر الخندق في غزوة الأحزاب؟", a: ["سلمان الفارسي", "عمر بن الخطاب", "علي بن أبي طالب", "حمزة بن عبد المطلب"], correct: 0, info: "سلمان الفارسي هو الذي أشار على النبي ﷺ بحفر الخندق، وكانت فكرة غير مألوفة عند العرب."},
    {q: "ما هي المدينة التي هاجر إليها المسلمون قبل الهجرة إلى المدينة المنورة؟", a: ["الحبشة", "الطائف", "الشام", "القدس"], correct: 0, info: "الهجرة الأولى كانت إلى الحبشة (إثيوبيا الحالية) هرباً من اضطهاد قريش."},
    {q: "من هو مؤلف كتاب 'الرسالة' الذي يُعتبر أول كتاب في علم أصول الفقه؟", a: ["الإمام الشافعي", "الإمام مالك", "الإمام أحمد", "الإمام أبو حنيفة"], correct: 0, info: "الإمام الشافعي هو أول من وضع كتاباً في علم أصول الفقه بعنوان 'الرسالة'."},
    {q: "كم شهر عسكري كانت مدة حصار المسلمين لحصن خيبر قبل أن يتم فتحه؟", a: ["شهر واحد", "ثلاثة أيام", "سنة كاملة", "أسبوعين"], correct: 0, info: "استمر حصار خيبر حوالي شهر كامل حتى استسلمت الحصون وفتحها المسلمون."},
    {q: "ما هو الحكم إذا اشترى شخص سلعة واكتشف فيها عيباً قديماً لم يعلم به؟", a: ["له الحق في رد السلعة (خيار العيب)", "يجب عليه قبولها مع خصم بسيط", "ليس له خيار بعد العقد", "يستغفر الله ويكمل البيع"], correct: 0, info: "يثبت له خيار العيب، وله أن يرد المبيع أو يمسكه مع أخذ أرش العيب (التعويض)."},
    {q: "ما هي العقوبة المقدرة شرعاً للزاني غير المحصن (الأعزب)؟", a: ["الجلد مائة جلدة وتغريب عام", "الرجم حتى الموت", "الجلد خمسون جلدة", "السجن سنة"], correct: 0, info: "عقوبة الزاني غير المحصن هي الجلد مائة جلدة وتغريبه (إبعاده عن البلد) عام كامل."},
    {q: "ماذا يُقصد بـ 'الحول' في باب الزكاة؟", a: ["مرور سنة قمرية على بلوغ النصاب", "مرور شهر على بلوغ النصاب", "مرور فصل كامل", "مرور سنة شمسية"], correct: 0, info: "الحول هو مرور سنة كاملة (قمرية) على ملك النصاب."},
    {q: "ما هو المصطلح الفقهي الذي يطلق على القصاص في غير النفس (مثل قطع اليد أو السن)؟", a: ["القصاص في الأطراف", "الديات", "الحدود", "التعزير"], correct: 0, info: "يُسمى القصاص في الأطراف (الجروح والأعضاء)، وهو مقابل قتل النفس (القصاص في النفس)."},
    {q: "ما هي أركان الصلاة التي لا تصح الصلاة إلا بها؟", a: ["القيام، الركوع، السجود، قراءة الفاتحة", "الأذان والإقامة", "الجهر في الصلاة الجهرية", "رفع اليدين عند التكبير"], correct: 0, info: "الأركان هي ما لا تجبر بسجود السهو، وأهمها الأربعة المذكورة، بالإضافة للنية والترتيب والسلام."},
    {q: "من هو الصحابي الذي أرسله النبي ﷺ إلى اليمن قاضياً ومعلماً؟", a: ["معاذ بن جبل", "أبو موسى الأشعري", "علي بن أبي طالب", "عثمان بن عفان"], correct: 0, info: "معاذ بن جبل رضي الله عنه، حيث علمه النبي ﷺ كيفية الحكم بالاجتهاد."},
    {q: "ما اسم الغزوة التي وقعت بعد صلح الحديبية بسبعة أشهر؟", a: ["غزوة خيبر", "غزوة تبوك", "غزوة حنين", "غزوة دومة الجندل"], correct: 0, info: "غزوة خيبر وقعت في محرم من السنة السابعة للهجرة، بعد العودة من صلح الحديبية."},
    {q: "ما هي أول عاصمة للدولة العباسية قبل الانتقال إلى بغداد؟", a: ["الكوفة", "دمشق", "البصرة", "سامراء"], correct: 0, info: "اتخذ أبو العباس السفاح الكوفة أول عاصمة للدولة العباسية."},
    {q: "ما هو الحكم إذا نسي الإمام ركناً من أركان الصلاة كالسجود؟", a: ["يجب عليه أن يأتي بالركن فوراً ويسجد للسهو", "تسقط عنه الركعة التي نسي فيها الركن", "يبني على الأقل ويكمل الصلاة", "يقطع الصلاة ويعيدها"], correct: 0, info: "إذا تذكر الركن الناقص أثناء الصلاة، لزمه الإتيان به والإتيان بما بعده، ثم سجود السهو."},
    {q: "ما هو 'التكبير المقيد' في أيام عيد الأضحى؟", a: ["التكبير بعد الصلوات المفروضة", "التكبير المطلق في الأسواق", "التكبير عند رؤية الهلال", "التكبير ليلة العيد فقط"], correct: 0, info: "التكبير المقيد هو الذي يكون عقب الصلوات المفروضة في أيام التشريق."},
    {q: "ما هي 'الرضاع المحرّم'؟", a: ["خمس رضعات مشبعات قبل الفطام", "رضعة واحدة بعد الفطام", "ثلاث رضعات في أي وقت", "رضاع بعد سن الثانية"], correct: 0, info: "الرضاع الذي يحرم النكاح به هو خمس رضعات مشبعات فأكثر في سن الرضاعة (قبل حولين) عند الشافعية والحنابلة."},
    {q: "ما الحكم الشرعي لـ 'الشفعة'؟", a: ["حق الجوار في أخذ العقار المبيع", "حق العاقد في فسخ العقد", "حق الشريك في أخذ العقار المبيع", "حق الولي في تزويج موليته"], correct: 2, info: "الشفعة هي حق الشريك القديم في العقار (أو الجار عند بعض الفقهاء) في تملك الحصة المبيعة بثمنها."},
    {q: "ما هو الحد الأدنى من الإبل الذي تجب فيه الزكاة؟", a: ["خمس من الإبل", "عشر من الإبل", "خمس عشرة من الإبل", "أربعون من الإبل"], correct: 0, info: "نصاب الإبل هو خمسة فصاعداً، وتجب فيها شاة واحدة."},
    {q: "من هو قائد معركة القادسية الذي انتصر فيها المسلمون على الفرس؟", a: ["سعد بن أبي وقاص", "خالد بن الوليد", "أبو عبيدة بن الجراح", "عمرو بن العاص"], correct: 0, info: "القائد هو سعد بن أبي وقاص رضي الله عنه (سنة 15 هـ)."},
    {q: "ما هو 'النسخ' في أصول الفقه؟", a: ["رفع الحكم الشرعي بدليل شرعي متأخر عنه", "تخصيص العام بالخاص", "بيان المجمل", "إلغاء الحديث الضعيف بالصحيح"], correct: 0, info: "النسخ هو إزالة الحكم الشرعي الذي جاء به نص سابق، بنص شرعي لاحق."},
    {q: "ماذا يُقصد بـ 'سجود التلاوة'؟", a: ["سجود لآيات معينة في القرآن", "سجود للسهو بعد الصلاة", "سجود بعد صلاة النافلة", "سجود الشكر"], correct: 0, info: "هو السجود الذي يؤدى عند قراءة أو سماع آيات معينة في القرآن ورد فيها أمر بالسجود."},
    {q: "ما الحكم إذا توضأ الشخص ونسي مسح الرأس؟", a: ["يجب عليه مسح الرأس فقط وإكمال الصلاة", "يجب عليه إعادة الوضوء بالكامل", "تصح صلاته ولا شيء عليه", "يجب عليه مسح الرأس وإعادة الصلاة"], correct: 0, info: "مسح الرأس ركن من أركان الوضوء، فإذا تذكره قريباً مسح رأسه فقط (وإن كان بعيداً لزمه إعادة الوضوء)."},
    {q: "متى يجوز الإفطار للحامل أو المرضع في رمضان؟", a: ["إذا خافت على نفسها أو ولدها", "في جميع الأحوال", "إذا كان الصيام شاقاً عليها فقط", "إذا كانت مسافرة فقط"], correct: 0, info: "يجوز لها الفطر ويجب عليها القضاء، ويجب عليها الفدية (إطعام مسكين عن كل يوم) إذا خافت على الجنين أو الطفل فقط."},
    {q: "ما هي السورة التي تسمى 'عروس القرآن'؟", a: ["سورة الرحمن", "سورة البقرة", "سورة يس", "سورة الملك"], correct: 0, info: "سورة الرحمن، لحديث: 'لكل شيء عروس، وعروس القرآن سورة الرحمن'."},
    {q: "من هو أول من جهر بالقرآن الكريم في مكة من الصحابة؟", a: ["عبد الله بن مسعود", "بلال بن رباح", "عمار بن ياسر", "أبو ذر الغفاري"], correct: 0, info: "هو عبد الله بن مسعود رضي الله عنه."},
    {q: "ما هي مدة الخلافة الراشدة؟", a: ["حوالي 30 سنة", "40 سنة", "20 سنة", "13 سنة"], correct: 0, info: "مدة الخلافة الراشدة تقريباً ثلاثون سنة، بدأت بوفاة النبي ﷺ عام 11 هـ وانتهت باستشهاد علي بن أبي طالب عام 40 هـ."},
    {q: "ما هو الحد الأدنى للنصاب الذي تجب فيه زكاة الزروع والثمار؟", a: ["خمسة أوسق (حوالي 650 كجم)", "نصف وسق", "عشرة أوسق", "وسق واحد"], correct: 0, info: "نصاب الزروع والثمار هو خمسة أوسق (653 كجم تقريباً)."},
    {q: "ماذا يُقصد بـ 'المُدَبَّر' في باب العتق؟", a: ["العبد الذي يعتق بعد موت سيده", "العبد الذي يعتق فوراً", "العبد الذي يعتق بمرور سنة", "العبد الذي يعتق إذا جاءه ولد"], correct: 0, info: "هو العبد الذي يعتقه سيده بعد وفاته (أي دبر موته)."},
    {q: "ما هو الحكم إذا أصيب الثوب بنجاسة لا يمكن إزالتها (مثل لون الحبر)؟", a: ["يُعفى عنها إذا لم يبق إلا اللون", "لا تصح الصلاة به أبداً", "يجب قص الجزء المتنجس", "يجب غسله بالخل"], correct: 0, info: "إذا لم يبق من النجاسة إلا الأثر أو اللون الذي يشق إزالته، فيُعفى عنه."},
    {q: "ما الحكم الفقهي لـ 'الوديعة'؟", a: ["هي عقد أمانة لحفظ مال الغير", "هي عقد تبرع وهبة", "هي عقد بيع بالتقسيط", "هي عقد قرض ربوي"], correct: 0, info: "الوديعة هي أن يضع شخص مالاً عند آخر ليحفظه له، وهي عقد أمانة."},
    {q: "ما اسم الصحابي الذي كان أميناً لسر النبي ﷺ؟", a: ["حذيفة بن اليمان", "أبو بكر الصديق", "عثمان بن عفان", "أبو هريرة"], correct: 0, info: "الصحابي هو حذيفة بن اليمان رضي الله عنه."},
    {q: "من هو القائد الذي فتح الأندلس في العصر الأموي؟", a: ["طارق بن زياد", "عقبة بن نافع", "موسى بن نصير", "محمد بن القاسم الثقفي"], correct: 0, info: "طارق بن زياد هو القائد الذي عبر المضيق (الذي سمي باسمه جبل طارق) وفتح الأندلس في عام 92 هـ."},
    {q: "ما هو المصطلح الفقهي الذي يطلق على التساوي بين طرفي عقد الصرف؟", a: ["التقابض والتماثل", "الربا والفضل", "التأجيل والأجل", "العقد الموقوف"], correct: 0, info: "يُشترط في الصرف (بيع العملات أو الذهب بالفضة) التقابض (الحيازة الفورية) والتماثل (في الجنس الواحد)."},
    {q: "ما الحكم إذا نوى الحاج العمرة فقط في أشهر الحج؟", a: ["متمتعاً", "قارناً", "مفرداً", "ملبياً"], correct: 0, info: "يسمى 'متمتعاً' لأنه تمتع بالخروج من الإحرام بعد العمرة قبل أن يحرم بالحج."},
    {q: "ما هي كفارة القتل الخطأ؟", a: ["دية مسلمة إلى أهله وتحرير رقبة مؤمنة وصيام شهرين", "دية مغلظة وصيام ثلاثة أشهر", "دية فقط", "صيام ثلاثة أيام فقط"], correct: 0, info: "كفارة القتل الخطأ هي الدية (مال) وصيام شهرين متتابعين وتحرير رقبة مؤمنة (إن وجدت)."},
    {q: "ما هو معنى 'القياس' في أصول الفقه؟", a: ["إلحاق واقعة لا نص فيها بواقعة ورد فيها نص لاشتراكهما في علة الحكم", "الاعتماد على رأي الصحابي", "الاستحسان العقلي", "إلغاء الحكم القديم"], correct: 0, info: "القياس هو إحدى الأدلة الشرعية المتفق عليها بعد الكتاب والسنة والإجماع."},
    {q: "ما اسم العام الذي وُلد فيه النبي محمد صلى الله عليه وسلم؟", a: ["عام الفيل", "عام الحزن", "عام الوفود", "عام الجماعة"], correct: 0, info: "عام الفيل، وهو العام الذي حاول فيه أبرهة الحبشي هدم الكعبة."},
    {q: "ما هي السورة التي ذكرت فيها البسملة مرتين؟", a: ["سورة النمل", "سورة الفاتحة", "سورة البقرة", "سورة يوسف"], correct: 0, info: "سورة النمل، حيث وردت مرة في البداية ومرة في قصة سليمان عليه السلام."},
    {q: "ماذا يُقصد بـ 'التدليس' في البيع؟", a: ["كتمان عيب السلعة عن المشتري", "بيع السلعة بأجل", "بيع السلعة بثمن عالٍ جداً", "الحلف كذباً على السعر"], correct: 0, info: "التدليس هو إخفاء العيب أو إظهار السلعة على غير حقيقتها مما يخدع المشتري."},
    {q: "ما حكم صلاة النافلة جالساً مع القدرة على القيام؟", a: ["جائزة مع تنصيف الأجر", "لا تجوز إلا لعذر", "مكروهة", "باطلة"], correct: 0, info: "يجوز في صلاة النافلة أن يصلي جالساً وله نصف أجر القائم، أما صلاة الفريضة فلا يجوز الجلوس فيها إلا لعذر."},
    {q: "كم سنة قضاها النبي ﷺ في الدعوة بمكة قبل الهجرة؟", a: ["13 سنة", "10 سنوات", "5 سنوات", "23 سنة"], correct: 0, info: "قضى النبي ﷺ 13 سنة في مكة يدعو إلى الإسلام."},
    {q: "من هو أول من أسلم من الموالي (غير العرب)؟", a: ["بلال بن رباح", "زيد بن حارثة", "صُهيب الرومي", "سلمان الفارسي"], correct: 0, info: "بلال بن رباح رضي الله عنه."},
    {q: "ما هي عاصمة الدولة الأيوبية؟", a: ["القاهرة", "دمشق", "القدس", "حلب"], correct: 0, info: "كانت القاهرة عاصمة الدولة الأيوبية التي أسسها صلاح الدين الأيوبي."},
    {q: "ما هو 'ربا النسيئة'؟", a: ["الزيادة مقابل تأخير قبض المال الربوي", "الزيادة في الجنس الواحد من الأموال", "بيع الغرر", "بيع العينة"], correct: 0, info: "ربا النسيئة هو الزيادة المشروطة على الأصل مقابل التأخير، أو تأخير قبض العوضين في الصرف (الربا الجلي)."},
    {q: "ما هي شروط وجوب الحج على المسلم؟", a: ["الإسلام، البلوغ، العقل، الحرية، الاستطاعة", "الغنى والصحة فقط", "أن يكون رجلاً مسافراً", "أن يكون لديه مائة ناقة"], correct: 0, info: "تلك هي شروط وجوب الحج المتفق عليها."},
    {q: "ما هي المدة الزمنية التي يشرع فيها للحاضر أن يمسح على الجوربين؟", a: ["يوم وليلة", "ثلاثة أيام بلياليها", "أسبوع كامل", "شهر واحد"], correct: 0, info: "للحاضر (غير المسافر) يوماً وليلة (24 ساعة) من أول حدث بعد لبسهما على طهارة."},
    {q: "ما الحكم إذا أدرك المأموم الإمام وهو في الركوع؟", a: ["تحسب له الركعة", "لا تحسب له الركعة ويجب عليه القضاء", "يجب عليه الانتظار حتى يرفع الإمام", "يقطع الصلاة ويعيدها"], correct: 0, info: "إذا أدرك الإمام في ركوعه قبل الرفع منه واطمأن، فقد أدرك الركعة عند جمهور الفقهاء."},
    {q: "ما هو المصطلح الذي يطلق على ترك المستحب والقيام بالواجب؟", a: ["الاستحسان", "الاستصحاب", "ترك الأفضل", "النسخ"], correct: 2, info: "عندما يترك الشخص سنة أو مستحباً للقيام بالواجب، يقال إنه ترك الأفضل (السنة) للقيام بالأهم (الواجب)."},
    {q: "ما اسم المعركة التي حدثت بين المسلمين والمغول وكان لها دور في حماية بلاد الشام؟", a: ["عين جالوت", "حطين", "اليرموك", "ذات السلاسل"], correct: 0, info: "معركة عين جالوت (658 هـ) بقيادة سيف الدين قطز، وهي التي أوقفت الزحف المغولي."},
    {q: "من هو آخر الخلفاء الراشدين؟", a: ["علي بن أبي طالب", "الحسن بن علي", "عمر بن الخطاب", "عثمان بن عفان"], correct: 0, info: "هو علي بن أبي طالب رضي الله عنه."},
    {q: "ما هي المدة التي تُعفى فيها الزكاة من عروض التجارة إذا لم يتم بيعها؟", a: ["لا يوجد إعفاء زمني (يجب الزكاة كل عام)", "عامان", "ستة أشهر", "ثلاثة أعوام"], correct: 0, info: "تجب الزكاة في عروض التجارة إذا حال عليها الحول وهي للبيع."},
    {q: "ماذا يُقصد بـ 'المُضاربة'؟", a: ["عقد شركة بين رأس مال وعمل", "عقد قرض ربوي", "بيع بالتقسيط", "تأجير أرض زراعية"], correct: 0, info: "المضاربة هي عقد بين طرفين، يقدم أحدهما المال (رب المال) ويقدم الآخر الجهد والعمل (المضارب)، ويكون الربح بينهما حسب الاتفاق."},
    {q: "ما حكم بيع السلعة بثمن مؤجل ثم بيعها بثمن أقل لغير بائعها الأول؟", a: ["بيع التورق الجائز", "بيع العينة المحرم", "بيع السلم", "بيع المرابحة"], correct: 0, info: "يسمى بيع التورق، وهو جائز عند جمهور الفقهاء خلافاً لبيع العينة."},
    {q: "ما هي كفارة الجماع في نهار رمضان؟", a: ["تحرير رقبة أو صيام شهرين متتابعين أو إطعام ستين مسكيناً", "قضاء اليوم فقط", "دفع غرامة مالية", "صيام عشرة أيام"], correct: 0, info: "هذه هي الكفارة الكبرى مرتبة على التخيير عند العجز."},
    {q: "في أي سنة هجرية كانت غزوة الأحزاب (الخندق)؟", a: ["السنة الخامسة للهجرة", "السنة السابعة للهجرة", "السنة الرابعة للهجرة", "السنة السادسة للهجرة"], correct: 0, info: "وقعت غزوة الخندق في شوال من السنة الخامسة للهجرة."},
    {q: "ما هو اسم السورة التي تسمى 'الفاضحة'؟", a: ["سورة التوبة", "سورة الأنفال", "سورة المائدة", "سورة الفتح"], correct: 0, info: "سورة التوبة، لأنها فضحت المنافقين."},
    {q: "ما هو الحكم إذا شك المصلي في ترك سنة من سنن الصلاة؟", a: ["يستمر في صلاته ولا شيء عليه", "يقطع الصلاة ويعيدها", "يسجد للسهو وجوباً", "يأتي بها فوراً"], correct: 0, info: "لا يلزم المصلي سجود السهو بترك سنة، بل يُستحب الاستمرار في الصلاة."},
    {q: "ما هو نوع المياه التي يجوز التطهير بها؟", a: ["الماء الطهور (المطلق)", "الماء النجس", "الماء المستعمل", "ماء الورد"], correct: 0, info: "الماء الطهور هو الأصل في الطهارة، وهو الماء الباقي على أصل خلقته."},
    {q: "ما هي العبادة التي لا تسقط عن المكلف أبداً ما دام عقله حاضراً؟", a: ["الصلاة", "الزكاة", "الصوم", "الحج"], correct: 0, info: "الصلاة هي العبادة الوحيدة التي لا تسقط أبداً (تُصلى قائماً، جالساً، مضطجعاً، أو بالإيماء)."},
    {q: "من هو الخليفة العباسي الذي أمر بتعريب الدواوين (النظام الإداري)؟", a: ["عبد الملك بن مروان", "هارون الرشيد", "عمر بن عبد العزيز", "المأمون"], correct: 0, info: "هذا السؤال تاريخياً ينسب لعبد الملك بن مروان (أموي)، ولكن الخيارات عباسية فقط. إذا كان السؤال يقصد التعريب الشامل للدولة الإسلامية بشكل عام، فهو عبد الملك الأموي."},
    {q: "ماذا يعني 'المكروه تحريماً' عند الحنفية؟", a: ["قريب من الحرام (النهي عن فعله)", "قريب من المباح", "مكروه تنزيهاً", "لا شيء فيه"], correct: 0, info: "المكروه تحريماً عند الأحناف هو ما ثبت النهي عنه بدليل ظني، وهو أقرب للحرام."},
    {q: "ما هي 'العُرْيَة' في البيوع؟", a: ["البيع دون تحديد السعر", "بيع الثمار التي لم يشتد صلبها بعد", "البيع بثمن مؤجل", "بيع سلعة مجهولة"], correct: 1, info: "العرايا هي نوع من البيوع استثناه الشرع لجواز بيع الرطب على رؤوس النخل بالتمر الجاف."},
    {q: "ما الحكم الفقهي لـ 'التخارج' في الميراث؟", a: ["هو بيع بعض الورثة حصصهم لورثة آخرين", "هو إلغاء الميراث بالكامل", "هو حرمان بعض الورثة من حقهم", "هو توزيع الميراث بالقرعة"], correct: 0, info: "التخارج هو أن يتفق الورثة على أن يخرج واحد منهم مقابل عوض معلوم، وهو جائز."},
    {q: "من هو الصحابي الذي قال عنه النبي ﷺ 'أصدق أمة محمد حياءً'؟", a: ["عثمان بن عفان", "عمر بن الخطاب", "أبو بكر الصديق", "علي بن أبي طالب"], correct: 0, info: "هو عثمان بن عفان رضي الله عنه."},
    {q: "في أي عهد من الخلفاء الراشدين تم نسخ القرآن الكريم وتوزيعه على الأمصار؟", a: ["عثمان بن عفان", "عمر بن الخطاب", "أبو بكر الصديق", "علي بن أبي طالب"], correct: 0, info: "في عهد عثمان بن عفان، جمع الناس على مصحف واحد يُعرف بالمصحف العثماني."},
    {q: "ما هي السورة التي تسمى 'المنجية'؟", a: ["سورة الملك (تبارك)", "سورة الكهف", "سورة يس", "سورة الواقعة"], correct: 0, info: "سورة الملك، لما ورد في فضلها أنها تمنع من عذاب القبر."},
    {q: "ما هو المصطلح الذي يطلق على التنازل عن حق القصاص مقابل مال؟", a: ["الصلح على الدية", "العفو", "الإبراء", "الهبة"], correct: 0, info: "الصلح على الدية هو تنازل ولي الدم عن القصاص مقابل دفع دية (مال)."},
    {q: "ما حكم إخراج زكاة الذهب والفضة إذا كانا للاستعمال الشخصي (حلية)؟", a: ["تجب فيها الزكاة عند الجمهور", "لا تجب فيها الزكاة عند الحنفية فقط", "لا تجب فيها الزكاة باتفاق", "تجب فيها الزكاة إذا بلغت نصاباً"], correct: 3, info: "خلاف بين الفقهاء، والأكثر فقهاً يرون وجوب الزكاة فيها إذا بلغت النصاب وحال عليها الحول (رأي الحنفية)."},
    {q: "ما هي أنواع الرهن في الفقه؟", a: ["رهن حيازي ورهن رسمي", "رهن الذهب ورهن العقار", "رهن الدين ورهن الأعيان", "رهن الثمن ورهن المثمن"], correct: 0, info: "هذه هي التصنيفات الحديثة للرهن، حيث يشترط فيه أن يكون الرهن لضمان دين."},
    {q: "ما الحكم إذا تذكرت وأنت في صلاة الظهر أنك لم تصلِّ صلاة العصر؟", a: ["تكمل الظهر ثم تصلي العصر", "تقطع الظهر وتصلي العصر ثم تقضي الظهر", "تقلب نية الظهر إلى العصر وتكمل", "تكمل الظهر ولا شيء عليك"], correct: 0, info: "الترتيب واجب بين الفوائت والآداء، لكن إذا تذكرت بعد الانتهاء، فالأداء صحيح والقضاء واجب."},
    {q: "ما هي 'المكاييل والموازين' التي يُقصد بها الأشياء التي تجب فيها الزكاة؟", a: ["الأشياء التي تقدر بالصاع والمُد والوزن", "الأشياء التي تقدر بالعدد", "الأشياء التي تقدر بالقياس", "الأشياء التي تقدر بالتقدير فقط"], correct: 0, info: "الأشياء التي تقدر بالمكاييل والموازين هي التي تجب فيها الزكاة (كالحبوب والتمر)."},
    {q: "ما الحكم إذا تم البيع بثمنين مختلفين، أحدهما نقداً والآخر مؤجلاً، دون تحديد أيهما في العقد؟", a: ["البيع فاسد (مجهول الثمن)", "البيع صحيح بالثمن الأعلى", "البيع صحيح بالثمن الأدنى", "البيع مكروه"], correct: 0, info: "البيع فاسد لعدم الجزم بالثمن عند العقد، ويسمى 'بيعتان في بيعة' المنهي عنه."},
    {q: "ما هي المادة التي كان العرب يستخدمونها في الجاهلية لصك العملات؟", a: ["الذهب والفضة", "النحاس والحديد", "الزجاج والرصاص", "البرونز"], correct: 0, info: "العملات الرئيسية كانت من الذهب (الدنانير) والفضة (الدراهم)."},
    {q: "ما هي الشروط الأساسية التي يجب أن تتوفر في الشاهد في القضاء؟", a: ["العدالة والبلوغ والعقل", "الثراء والعلم والعدالة", "الذكورية والعدالة والشهرة", "أن يكون صاحب منصب"], correct: 0, info: "يشترط في الشاهد أن يكون عدلاً (صادقاً مجتنب الكبائر) وبالغاً وعاقلاً."},
    {q: "ما هي أول آية نزلت من القرآن الكريم؟", a: ["اقرأ باسم ربك الذي خلق", "يا أيها المدثر", "بسم الله الرحمن الرحيم", "الحمد لله رب العالمين"], correct: 0, info: "أول خمس آيات نزلت كانت من سورة العلق (اقرأ باسم ربك الذي خلق)."},
    {q: "من هو الصحابي الذي طلق زوجته بأمر من النبي ﷺ بعدما اكتشف بها عيباً؟", a: ["ابن مسعود", "عبد الرحمن بن عوف", "عمر بن الخطاب", "سعد بن معاذ"], correct: 0, info: "لم يرد نص صريح بذلك، لكن السؤال يشير إلى أن النبي ﷺ كان يتدخل في بعض حالات الطلاق لأسباب شرعية أو عيوب."},
    {q: "ما هي الغزوة التي نُقض فيها الصلح مع قريش وتم فتح مكة بعدها؟", a: ["غزوة فتح مكة (العشرة آلاف)", "غزوة حنين", "غزوة الطائف", "غزوة تبوك"], correct: 0, info: "غزوة فتح مكة (8 هـ) جاءت بعد نقض قريش لصلح الحديبية."},
    {q: "ماذا يُقصد بـ 'أدب القاضي'؟", a: ["الصفات التي يجب أن يتصف بها القاضي وسلوكه", "قواعد الإجراءات القضائية", "العقوبات التي يصدرها القاضي", "كتب الفقه المتعلقة بالأقضية"], correct: 0, info: "أدب القاضي يشمل سلوكه، كيفية معاملته للخصوم، وطريقة إصدار الأحكام."},
    {q: "ما الحكم إذا مات المسلم وعليه دين يغرق جميع تركته؟", a: ["لا يوزع الميراث حتى يقضى الدين", "يوزع الميراث ويبقى الدين على الورثة", "يتحمل بيت مال المسلمين الدين", "يسقط الدين بموت المدين"], correct: 0, info: "قضاء الدين مقدم على توزيع الميراث والوصية."},
    {q: "ما هو 'حكم المكره' في العقود الفقهية؟", a: ["عقده غير صحيح إلا في حالات محددة", "عقده صحيح ونافذ", "عقده موقوف على إجازته بعد زوال الإكراه", "عقده باطل مطلقاً"], correct: 0, info: "عقد المكره لا يصح في الأصل لأنه لا تراضي فيه، إلا في عقود معينة كَالطلاق عند بعض الفقهاء."},
    {q: "من هو أول من أدخل نظام العسس (دوريات الأمن الليلية) في الإسلام؟", a: ["عمر بن الخطاب", "عثمان بن عفان", "علي بن أبي طالب", "أبو بكر الصديق"], correct: 0, info: "هو عمر بن الخطاب رضي الله عنه."},
    {q: "ما هي المدينة التي كانت عاصمة الدولة الفاطمية؟", a: ["القاهرة", "فاس", "القيروان", "المهدية"], correct: 0, info: "القاهرة كانت عاصمة الفاطميين بعد تأسيسها في مصر."},
    {q: "ماذا يُقصد بـ 'بيع السَلَم'؟", a: ["بيع موصوف في الذمة بثمن معجل", "بيع سلعة حاضرة بثمن مؤجل", "بيع سلعة بثمن مجهول", "بيع الذهب بالذهب"], correct: 0, info: "بيع السلم هو عقد على موصوف في الذمة بثمن مقبوض في مجلس العقد."},
    {q: "ما هي العبادة التي اشترط فيها جمهور الفقهاء النية من الليل؟", a: ["صوم الفرض (رمضان)", "صلاة النافلة", "الحج والعمرة", "زكاة المال"], correct: 0, info: "يشترط لِصحة صوم الفرض (رمضان) النية قبل الفجر."},
    {q: "ما الحكم إذا قطع المأموم صلاته قبل الإمام بعذر؟", a: ["لا يجوز له ذلك ويجب عليه القضاء", "يجوز إذا كان لضرورة", "تصح صلاته ولا شيء عليه", "يجب عليه سجود السهو"], correct: 0, info: "مفارقة الإمام بغير عذر لا تجوز، ولكن بعذر كطول الإمام أو تذكر حدث سابق، يجوز."},
    {q: "ما هو المصطلح الذي يطلق على الشك في الطهارة بعد اليقين بها؟", a: ["قاعدة اليقين لا يزول بالشك", "الاستصحاب", "الاستدلال", "القياس"], correct: 0, info: "هذه قاعدة فقهية عظيمة: الأصل بقاء ما كان على ما كان، فالطهارة تبقى ولا تزول بالشك."},
    {q: "ما هي الآية التي تعتبر أطول آية في القرآن الكريم؟", a: ["آية الدين", "آية الكرسي", "آية المواريث", "آية سورة البقرة التي تليها"], correct: 0, info: "آية الدين هي أطول آية في القرآن (الآية 282 من سورة البقرة)."},
    {q: "ماذا يُقصد بـ 'الغرر' في البيوع؟", a: ["الجهالة في المبيع التي تؤدي للنزاع", "تحديد السعر مسبقاً", "تحديد الأجل مسبقاً", "تغيير سعر السلعة باستمرار"], correct: 0, info: "الغرر هو عدم التيقن من حصول المعقود عليه، ويؤدي إلى بطلان العقد (كبيع السمك في الماء)."},
    {q: "من هو أول من جَمَعَ الناس على صلاة التراويح في رمضان؟", a: ["عمر بن الخطاب", "عثمان بن عفان", "أبو بكر الصديق", "علي بن أبي طالب"], correct: 0, info: "عمر بن الخطاب رضي الله عنه، حيث أمر أبي بن كعب أن يصلي بالناس التراويح جماعة."},
    {q: "ما هي 'العقيقة'؟", a: ["ما يذبح للمولود شكراً لله", "ما يذبح في عيد الأضحى", "الذبائح التي تقدم في الحج", "الذبح عند العودة من سفر طويل"], correct: 0, info: "العقيقة هي سنة مؤكدة، وتذبح شاتان عن الغلام وشاة عن الجارية."},
    {q: "ما الحكم الفقهي لـ 'الوكالة'؟", a: ["إنابة شخص آخر بالتصرف نيابة عنه", "إعطاء قرض مالي لشخص آخر", "عقد هبة غير قابل للفسخ", "عقد بيع مؤجل"], correct: 0, info: "الوكالة هي عقد جائز، يجوز لكل من الموكل والوكيل فسخه ما لم يتعلق به حق للغير."},
    {q: "ما هي السورة التي كان النبي ﷺ يقرأها يوم الجمعة في الركعة الأولى من صلاة الفجر؟", a: ["السجدة", "الإنسان", "يوسف", "الكهف"], correct: 0, info: "سورة السجدة وسورة الإنسان (أو الدهر) كان يقرأهما النبي ﷺ في صلاة فجر يوم الجمعة."},
    {q: "ماذا يُقصد بـ 'خيار الشرط' في البيع؟", a: ["أن يشترط أحد المتعاقدين لنفسه أو لغيره حق فسخ العقد مدة معلومة", "أن يشترط أحد المتعاقدين صفة معينة في المبيع", "أن يشترط أحد المتعاقدين تأجيل الثمن", "أن يشترط المشتري الخيار عند رؤية السلعة"], correct: 0, info: "خيار الشرط هو الحق في فسخ العقد خلال مدة متفق عليها (عادة ثلاثة أيام) دون عيب أو غبن."},
    {q: "من هو آخر ملوك بني أمية في الأندلس؟", a: ["هشام المعتد بالله", "عبد الرحمن الناصر", "عبد الرحمن الداخل", "محمد بن أبي عامر"], correct: 0, info: "هشام المعتد بالله، الذي سقطت الدولة الأموية في عهده بالأندلس عام 422 هـ."},
    {q: "ما هو 'التأمين التكافلي' (التعاوني) من وجهة النظر الشرعية؟", a: ["عقد تبرع وتعاون جائز", "عقد غرر محرم", "عقد بيع آجل", "عقد قرض ربوي"], correct: 0, info: "التأمين التعاوني أو التكافلي مبني على التبرع والتعاون بين المشتركين، وهو الصيغة المقبولة شرعاً."},
    {q: "كم صاعاً من الشعير يُقدر به نصاب زكاة الفطر؟", a: ["صاع واحد", "نصف صاع", "ثلاثة أصواع", "صاعين"], correct: 0, info: "نصاب زكاة الفطر هو صاع واحد من غالب قوت أهل البلد (صاع نبوي)."},
    {q: "ما هي الغزوة التي وُصفت بأنها 'يوم الفرقان'؟", a: ["غزوة بدر الكبرى", "غزوة أحد", "غزوة الخندق", "غزوة حنين"], correct: 0, info: "غزوة بدر الكبرى، حيث فرق الله فيها بين الحق والباطل."},
    {q: "ما هو الحكم إذا تكررت النجاسة على الثوب دون غسل؟", a: ["لا تصح الصلاة إلا بعد غسل واحد فقط", "تجب إعادة الغسل لكل نجاسة", "تصح الصلاة إذا كانت النجاسة قليلة", "يُعفى عن النجاسة المتكررة"], correct: 0, info: "الأصل أن النجاسة المتكررة على الثوب تجب إزالتها بغسلة واحدة تكفي لإزالة عين النجاسة."},
    {q: "من هو 'سيد التابعين'؟", a: ["سعيد بن المسيب", "الحسن البصري", "عروة بن الزبير", "محمد بن سيرين"], correct: 0, info: "سعيد بن المسيب رحمه الله."},
    {q: "ما هو الحكم إذا رأى المسلم هلال رمضان ثم رُدَّت شهادته؟", a: ["يجب عليه الصوم", "لا يجب عليه الصوم", "يصوم ويجب عليه القضاء", "يصوم تطوعاً"], correct: 0, info: "إذا رأى الهلال بنفسه، وجب عليه الصوم لأنه تحقق من بداية الشهر."},
    {q: "ماذا يُقصد بـ 'الإعسار' في الفقه المالي؟", a: ["عدم القدرة على سداد الدين", "كثرة المال والديون", "بيع السلعة بأقل من سعرها", "البيع بثمن مؤجل"], correct: 0, info: "الإعسار هو العجز عن الوفاء بالدين، ويوجب إنظار المدين (إمهاله)."},
    {q: "ما هي المدينة التي كانت عاصمة الدولة السلجوقية؟", a: ["نيسابور", "أصفهان", "بغداد", "دمشق"], correct: 0, info: "اتخذ السلاجقة نيسابور ثم أصفهان عاصمة لهم في فترات مختلفة."},
    {q: "ما الحكم إذا نوى الإمام صلاة الظهر ونوى المأموم صلاة العصر؟", a: ["تصح صلاة المأموم إذا كان إماماً لنفسه", "لا تصح صلاة المأموم بالاتفاق", "تصح صلاة المأموم خلف الإمام", "يجب إعادة الصلاة للإمام والمأموم"], correct: 2, info: "تصح صلاة المفترض خلف المتنفل، وصلاة الظهر خلف العصر، وصلاة الفرض خلف الفرض، طالما كان الإمام أرفع منه في النية أو متساوياً (عند الجمهور)."},
    {q: "من هو الصحابي الذي أُمر بقتل رجل كان يريد غزو المسلمين؟", a: ["خالد بن الوليد", "علي بن أبي طالب", "أبو بكر الصديق", "عمر بن الخطاب"], correct: 0, info: "خالد بن الوليد، حين أمره النبي ﷺ بالذهاب إلى بني جذيمة بعد فتح مكة."},
    {q: "ما هو الحكم إذا كان الماء الذي يريد الشخص الوضوء به مسخناً بالشمس؟", a: ["مكروه تنزيهاً مع صحة الوضوء", "مباح ولا كراهة", "مكروه تحريماً", "لا يجوز الوضوء به"], correct: 0, info: "الماء المشمس مكروه عند الشافعية والمالكية، مع صحة الطهارة به."},
    {q: "ما هي المدة التي يُحرم فيها بيع الثمار بعد بدو صلاحها؟", a: ["لا يُحرم البيع إذا بدا صلاحها", "يوم واحد", "أسبوع كامل", "حتى يتم جمع المحصول"], correct: 0, info: "إذا بدا صلاح الثمر، جاز بيعه بجميع شروطه."},
    {q: "ما الحكم الفقهي لـ 'الاستصناع'؟", a: ["عقد على عمل شيء معين في المستقبل", "عقد على بيع سلعة حاضرة", "عقد على رهن العقار", "عقد على الإيجار"], correct: 0, info: "عقد الاستصناع هو عقد مع صانع لعمل شيء معين بمواصفات محددة."},
    {q: "ما هي السورة التي كان النبي ﷺ يقرأها في صلاة العيد؟", a: ["ق", "الذاريات", "ق والذاريات", "الأعلى والغاشية"], correct: 3, info: "سورة الأعلى وسورة الغاشية هي السور التي وردت في الأحاديث بأنه كان يقرؤها في العيد."},
    {q: "ما الحكم إذا مات المسلم تاركاً أباً وأماً وزوجة وابناً وبنتاً؟", a: ["يرث جميعهم بفرض أو تعصيب", "يرث الأب والأم فقط", "يرث الابن والزوجة فقط", "يرث الأبوان ثلث التركة"], correct: 0, info: "في هذه الحالة، يرث الزوجة الثمن، والأب والأم السدسان، والباقي للابن والبنت تعصيباً للذكر مثل حظ الأنثيين."},
    {q: "ما هي الغزوة التي قال عنها النبي ﷺ: 'لم يبق بعده قتال'؟", a: ["غزوة تبوك", "غزوة حنين", "غزوة الطائف", "غزوة خيبر"], correct: 0, info: "غزوة تبوك، حيث كانت آخر غزوة قادها النبي ﷺ بنفسه، وكانت ضد الروم."},
    {q: "من هو الصحابي الذي قال عنه النبي ﷺ: 'لو لم أبعث فيكم لبعثت في أمتكم'؟", a: ["زيد بن حارثة", "أنس بن مالك", "أبو موسى الأشعري", "سلمان الفارسي"], correct: 0, info: "العبارة المشهورة هي: 'نِعم الرجل عبد الله بن عمر، لو كان يقوم من الليل' موجهة لابن عمر. أما العبارة المذكورة في السؤال فلا أصل لها، لكن أقرب الصحابة بهذا المعنى هو زيد بن حارثة كأقرب الناس إليه."},
    {q: "ما هي المدينة التي كانت عاصمة الدولة العثمانية بعد فتح القسطنطينية؟", a: ["إسطنبول", "أنقرة", "بورصة", "أدرنة"], correct: 0, info: "تم تغيير اسمها إلى إسلامبول (أو إسطنبول) بعد فتحها من قبل السلطان محمد الفاتح."},
    {q: "ما الحكم إذا نوى المسافر صوم النفل في رمضان؟", a: ["يجب عليه أن يصوم فرضاً", "يجوز صيام النفل", "يجب عليه الإفطار", "يصوم النفل ويقضي بعد رمضان"], correct: 0, info: "إذا نوى صوم النفل وهو في رمضان، تحولت نيته إلى صوم الفرض ويجب عليه الصوم."},
    {q: "ما هو 'التفويض' في باب النكاح؟", a: ["أن يترك تحديد المهر لتقدير الزوجة", "أن يترك تحديد المهر لتقدير القاضي", "أن يفوض الزوج زوجته في الطلاق", "أن يترك الزوج تحديد مكان الإقامة للزوجة"], correct: 0, info: "التفويض هو أن يعقد الزوج عليها دون تسمية مهر، ويسمى 'نكاح التفويض'."},
    {q: "ماذا يُقصد بـ 'المفلس' في الفقه؟", a: ["من زادت ديونه على ماله", "من لا يملك شيئاً على الإطلاق", "من يبيع سلعته بأقل من سعرها", "البيع بثمن مؤجل"], correct: 0, info: "المفلس هو من حجر عليه القاضي لزيادة ديونه على أمواله."},
    {q: "ما هو الحكم الفقهي لـ 'الاستئجار'؟", a: ["عقد معاوضة على منفعة معلومة بعوض معلوم", "عقد تبرع وهبة", "عقد قرض ربوي", "عقد بيع مؤجل"], correct: 0, info: "الاستئجار (الإجارة) هو بيع المنفعة لا العين، وهو عقد لازم."},
    {q: "من هو الصحابي الذي وُصف بأنه 'أمين هذه الأمة'؟", a: ["أبو عبيدة عامر بن الجراح", "عمر بن الخطاب", "عثمان بن عفان", "معاذ بن جبل"], correct: 0, info: "أبو عبيدة عامر بن الجراح رضي الله عنه."},
    {q: "ما هي السورة التي كان النبي ﷺ يقرأها في الركعة الثانية من صلاة الجمعة؟", a: ["الغاشية", "الأعلى", "المنافقون", "الجمعة"], correct: 0, info: "سورة الغاشية هي السورة التي كان يقرؤها بعد سورة الأعلى في صلاة الجمعة."},
    {q: "ما الحكم إذا نوى المأموم متابعة الإمام ثم سبقه إلى الركوع؟", a: ["تبطل صلاته إذا تعمد", "يجب عليه إعادة الصلاة", "تصح صلاته مع الكراهة", "يجب عليه سجود السه و"], correct: 0, info: "مساواة الإمام أو سبقه في الأركان (غير تكبيرة الإحرام والسلام) يُكره، وقد تبطل صلاته إذا سبقه بركنين عند بعض الفقهاء."},
    {q: "ما هي 'العارِيَة' في الفقه؟", a: ["إباحة الانتفاع بالشيء مجاناً مع بقاء عينه", "إعطاء القرض المالي", "عقد بيع الآجل", "عقد الإجارة"], correct: 0, info: "العارية هي إباحة الانتفاع بالشيء (كاستعارة سيارة) مع بقاء العين لردها لاحقاً."},
    {q: "ما هو الحد الأدنى من الغنم الذي تجب فيه الزكاة؟", a: ["أربعون شاة", "عشرون شاة", "ثلاثون شاة", "مائة شاة"], correct: 0, info: "نصاب الغنم هو أربعون شاة فصاعداً، وتجب فيه شاة واحدة."},
    {q: "ماذا يُقصد بـ 'خيار الرؤية' في البيع؟", a: ["الحق في فسخ العقد عند رؤية السلعة المشتراة غائبة", "الحق في فسخ العقد إذا لم يعرض البائع كل سلعته", "الحق في فسخ العقد إذا لم يرى الثمن", "الحق في فسخ العقد إذا لم ير الشاهد السلعة"], correct: 0, info: "خيار الرؤية هو الحق الثابت للمشتري في فسخ العقد إذا اشترى سلعة غائبة ثم رآها ووجدها على غير ما توقع."},
    {q: "ما هي المدة التي تُقضى فيها صلاة الفائتة على الترتيب؟", a: ["إذا كانت الفوائت قليلة (أقل من ست صلوات)", "في جميع الأحوال", "إذا كانت الفوائت كثيرة", "لا يجب الترتيب أبداً"], correct: 0, info: "يجب الترتيب بين الصلوات الفائتة إذا كانت قليلة، ويسقط بالنسيان أو بالجهل أو بالكثيرة (التي تزيد عن خمس صلوات)."},
    {q: "ما الحكم إذا ماتت المرأة ولا ولي لها؟", a: ["السلطان (القاضي) ولي من لا ولي له", "ترثها الزوجة فقط", "لا ترث إلا أقاربها من بعيد", "يسقط حقها في الولي"], correct: 0, info: "السلطان أو القاضي هو الولي الشرعي لمن لا ولي له في النكاح والميراث."},
    {q: "ماذا يُقصد بـ 'بيع المرابحة للآمر بالشراء'؟", a: ["وعد بالشراء ثم بيع السلعة بثمن الشراء مضافاً إليه ربح معلوم", "بيع السلعة بأجل مع زيادة", "بيع سلعة لم يملكها البائع بعد", "عقد قرض ربوي"], correct: 0, info: "هو صيغة تمويلية إسلامية، حيث يشتري البنك السلعة بناءً على طلب العميل ثم يبيعها له بربح متفق عليه."},
    {q: "من هو أول من أدخل نظام القضاء في الإسلام؟", a: ["النبي محمد ﷺ", "أبو بكر الصديق", "عمر بن الخطاب", "علي بن أبي طالب"], correct: 0, info: "القضاء كان موجوداً منذ عهد النبي ﷺ، ثم طوره الخلفاء الراشدون."},
    {q: "ما هو 'حكم المضطر' في الفقه؟", a: ["يجوز له فعل المحظور للنجاة بالنفس مع دفع الضرر", "لا يجوز له فعل الحرام أبداً", "يجوز له فعل المحظور دون دفع الضرر", "لا يجوز له فعل المحظور إلا بفتوى القاضي"], correct: 0, info: "الضرورات تبيح المحظورات بشرط أن يكون الضرر مزالاً بالقدر الذي يحافظ على النفس."},
    {q: "ما هي المدينة التي كانت عاصمة الدولة الأموية في الأندلس؟", a: ["قرطبة", "غرناطة", "إشبيلية", "طليطلة"], correct: 0, info: "قرطبة كانت عاصمة الخلافة الأموية في الأندلس."},
    {q: "ما هي السورة التي إذا قرأها المسلم كل ليلة وقيته من فتنة المسيح الدجال؟", a: ["سورة الكهف (أول عشر آيات)", "سورة يس", "سورة الإخلاص", "سورة الزلزلة"], correct: 0, info: "ورد في الحديث أن قراءة العشر آيات الأوائل من سورة الكهف تعصم من الدجال."},
    {q: "ما هو الحكم إذا شك المصلي في النية بعد تكبيرة الإحرام؟", a: ["تبطل صلاته", "يستمر في صلاته ولا شيء عليه", "يسجد للسهو", "يجب عليه تجديد تكبيرة الإحرام"], correct: 0, info: "النية شرط لصحة الصلاة، فإذا شك في وجودها أو تعيينها بعد تكبيرة الإحرام تبطل صلاته."},
    {q: "ما هو الحد الأدنى الذي يجب أن يتوفر في عروض التجارة حتى تجب فيها الزكاة؟", a: ["أن تبلغ قيمة النصاب من الذهب أو الفضة", "أن تبلغ قيمتها ألف ريال سعودي", "أن يمر عليها حول كامل", "أن يتم بيعها بالكامل"], correct: 0, info: "يشترط أن تبلغ قيمتها نصاب أحد النقدين (الذهب أو الفضة)."}
];

// *** 2. تحويل أسئلة الاختيار المتعدد إلى أسئلة صح أو خطأ (لجولة جديدة) ***
// 1. استخدام السؤال الأصلي + الإجابة الصحيحة = "صحيح"
// 2. استخدام السؤال الأصلي + إجابة خاطئة = "خطأ"
const TF_QUESTIONS_DATA = ALL_QUESTIONS_DATA.flatMap(q => {
    const correctAns = q.a[q.correct];
    // نأخذ أول إجابة خاطئة متاحة (إذا كان هناك أكثر من خيار واحد)
    const wrongAns = q.a.find((text, i) => i !== q.correct) || q.a[0]; 

    return [
        // السؤال الأول: العبارة الصحيحة
        {
            q: `${q.q.replace('؟', '')} هو: ${correctAns}.`,
            a: ["صحيح", "خطأ"],
            correct: 0, // الإجابة الصحيحة هي "صحيح"
            info: q.info
        },
        // السؤال الثاني: العبارة الخاطئة
        {
            q: `${q.q.replace('؟', '')} هو: ${wrongAns}.`,
            a: ["صحيح", "خطأ"],
            correct: 1, // الإجابة الصحيحة هي "خطأ"
            info: q.info
        }
    ];
});


// *** 3. إعدادات الاختبار ***
const QUIZ_LENGTH = 10;
const TIME_PER_QUESTION = 15;
let currentQuestionIndex = 0;
let score = 0;
let answered = false;
let questionTimer;
let questionCountdown;
let currentQuizType = 'mcq'; // mcq or tf
let bestScoreMCQ = parseInt(localStorage.getItem('bestScoreMCQ') || '0');
let bestScoreTF = parseInt(localStorage.getItem('bestScoreTF') || '0');
let username = '';

// *** متغيرات الإحصائيات المتراكمة الجديدة ***
let totalAttempted = parseInt(localStorage.getItem('totalAttempted') || '0');
let totalCorrect = parseInt(localStorage.getItem('totalCorrect') || '0');
let totalWrong = parseInt(localStorage.getItem('totalWrong') || '0');
// ---------------------------------------------


// *** 4. عناصر الواجهة والأصوات (التحقق من وجودها قبل البدء) ***
const quizContainer = document.getElementById('quiz');
const result = document.getElementById('result');
const nextButton = document.getElementById('next-btn');
const progressFill = document.getElementById('progress-fill');
const progressBar = document.querySelector('.progress-bar');
const timerElement = document.getElementById('timer');
const timerNumber = document.getElementById('timer-number');
const loadingMessage = document.getElementById('loading-message');
const loginScreen = document.getElementById('login-screen');
const welcomeScreen = document.getElementById('welcome-screen');
const startGameBtn = document.getElementById('start-game-btn');
const usernameInput = document.getElementById('username-input');
const welcomeUsername = document.getElementById('welcome-username');
const greetingMessage = document.getElementById('greeting-message');
const profileButton = document.getElementById('profile-btn'); 

const soundCorrect = document.getElementById('sound-correct');
const soundWrong = document.getElementById('sound-wrong');
const soundTimeUp = document.getElementById('sound-timeup');
const backgroundMusic = document.getElementById('background-music');
const musicToggleButton = document.getElementById('music-toggle-btn');
const startMCQBtn = document.getElementById('start-mcq-btn');
const startTFBtn = document.getElementById('start-tf-btn');

let selectedQuestions = []; // الأسئلة التي يتم اختيارها في كل جولة

// *** 5. وظائف إدارة الحالة ***

// وظيفة حفظ الاسم وأعلى نتيجة والإحصائيات المتراكمة في المتصفح
function saveUserData() {
    localStorage.setItem('username', username);
    localStorage.setItem('bestScoreMCQ', bestScoreMCQ);
    localStorage.setItem('bestScoreTF', bestScoreTF);
    localStorage.setItem('totalAttempted', totalAttempted);
    localStorage.setItem('totalCorrect', totalCorrect);
    localStorage.setItem('totalWrong', totalWrong);
}

// *** وظيفة تهيئة شاشة الترحيب (تم تعديلها لضمان ربط الأحداث) ***
function showWelcomeScreen() {
    // 1. التأكد من أن عنصر شاشة الترحيب موجود ومرئي
    if (!welcomeScreen) return; 
    
    // 2. إخفاء الشاشة الحالية
    if (loginScreen) loginScreen.classList.add('hidden');
    
    // 3. إظهار شاشة الترحيب وإعدادها
    welcomeScreen.classList.remove('hidden');
    welcomeScreen.classList.add('question-card');

    // 4. تحديث النص بالاسم الجديد
    if (welcomeUsername) welcomeUsername.textContent = username;
    if (greetingMessage) greetingMessage.innerHTML = `مرحباً بك يا **${username}**!`;
    
    // 5. إخفاء عناصر اللعب غير المرغوب فيها
    if (progressBar) progressBar.classList.add('hidden');
    if (nextButton) nextButton.classList.add('hidden');
    if (result) result.classList.add('hidden');
    if (timerElement) timerElement.classList.add('hidden'); 
    
    if (quizContainer) quizContainer.innerHTML = '';
    
    // 6. ربط الأزرار بشكل آمن بعد التأكد من وجودها
    if(profileButton) {
        profileButton.removeEventListener('click', showProfileScreen); // إزالة الربط القديم
        profileButton.addEventListener('click', showProfileScreen);
    }
    
    if(startMCQBtn) {
        // نستخدم دالة خارجية لتجنب المشاكل
        startMCQBtn.removeEventListener('click', handleStartQuiz); 
        startMCQBtn.addEventListener('click', handleStartQuiz);
    }
    
    if(startTFBtn) {
        startTFBtn.removeEventListener('click', handleStartQuiz);
        startTFBtn.addEventListener('click', handleStartQuiz);
    }
}

// دالة لمعالجة بدء الاختبار (تُستخدم لربط آمن)
function handleStartQuiz(e) {
    // التأكد من أن الزر يحتوي على خاصية data-type
    const type = e.currentTarget.dataset.type;
    if (type) {
        initializeQuestions(type);
    }
}


// *** دالة عرض شاشة الملف الشخصي والإحصائيات ***
function showProfileScreen() {
    // إخفاء جميع عناصر اللعب
    if (quizContainer) quizContainer.innerHTML = '';
    if (result) result.classList.add('hidden');
    if (welcomeScreen) welcomeScreen.classList.add('hidden');
    if (timerElement) timerElement.classList.add('hidden');
    if (progressBar) progressBar.classList.add('hidden');
    if (nextButton) nextButton.classList.add('hidden');
    
    // التأكد من تحميل أحدث الإحصائيات 
    totalAttempted = parseInt(localStorage.getItem('totalAttempted') || '0');
    totalCorrect = parseInt(localStorage.getItem('totalCorrect') || '0');
    totalWrong = parseInt(localStorage.getItem('totalWrong') || '0');

    // حساب نسبة النجاح الكلية
    const overallSuccessRate = totalAttempted > 0 
        ? ((totalCorrect / totalAttempted) * 100).toFixed(2) 
        : '0.00';
    
    // تصميم محتوى الملف الشخصي
    const profileHTML = `
        <div class="card question-card mt-6 text-center">
            <h2 class="text-4xl font-extrabold mb-6 text-yellow-300">👤 ملفك الشخصي يا ${username}</h2>
            <p class="text-xl mb-6">إحصائياتك التراكمية عبر جميع الجولات:</p>
            
            <div class="grid grid-cols-2 gap-4 mb-6 profile-stats-grid">
                <div class="stat-box bg-blue-700 p-4 rounded-lg">
                    <p class="text-4xl font-bold">${totalAttempted}</p>
                    <p class="text-sm mt-1">إجمالي الأسئلة</p>
                </div>
                <div class="stat-box bg-green-700 p-4 rounded-lg">
                    <p class="text-4xl font-bold">${totalCorrect}</p>
                    <p class="text-sm mt-1">إجابات صحيحة</p>
                </div>
                <div class="stat-box bg-red-700 p-4 rounded-lg">
                    <p class="text-4xl font-bold">${totalWrong}</p>
                    <p class="text-sm mt-1">إجابات خاطئة</p>
                </div>
                 <div class="stat-box bg-yellow-700 p-4 rounded-lg">
                    <p class="text-4xl font-bold">${overallSuccessRate}%</p>
                    <p class="text-sm mt-1">معدل النجاح</p>
                </div>
            </div>
            
            <p class="text-lg font-bold mt-6 mb-4">🏆 أعلى النتائج المُسجلة:</p>
            <p><strong>الاختيار المتعدد:</strong> ${bestScoreMCQ} من ${QUIZ_LENGTH}</p>
            <p><strong>صح أو خطأ:</strong> ${bestScoreTF} من ${QUIZ_LENGTH}</p>
            
            <button id="return-to-welcome-from-profile" class="main-btn mt-8">العودة إلى الشاشة الرئيسية</button>
            <button id="reset-stats-btn" class="alt-btn mt-4 bg-gray-600 hover:bg-gray-500">تصفير الإحصائيات الكلية</button>
        </div>
    `;
    if (quizContainer) quizContainer.innerHTML = profileHTML;
    
    // ربط الأزرار بعد وضعها في DOM مباشرةً
    const returnBtn = document.getElementById('return-to-welcome-from-profile');
    if (returnBtn) returnBtn.addEventListener('click', showWelcomeScreen);
    
    // معالج زر تصفير الإحصائيات
    const resetBtn = document.getElementById('reset-stats-btn');
    if (resetBtn) {
        resetBtn.addEventListener('click', () => {
            if(confirm("هل أنت متأكد من تصفير جميع إحصائياتك الكلية؟ (لن يتم تصفير أعلى نتيجة)")) {
                totalAttempted = 0;
                totalCorrect = 0;
                totalWrong = 0;
                saveUserData();
                showProfileScreen(); // إعادة عرض الشاشة بالقيم الجديدة (الصفر)
            }
        });
    }
}
// -------------------------------------------------------------------------------------

// وظيفة خلط واختيار الأسئلة
function initializeQuestions(type) {
    if (loadingMessage) loadingMessage.classList.remove('hidden');
    if (welcomeScreen) welcomeScreen.classList.add('hidden');
    
    currentQuizType = type;
    const sourceData = type === 'mcq' ? ALL_QUESTIONS_DATA : TF_QUESTIONS_DATA;

    if (sourceData.length < QUIZ_LENGTH) {
        if (quizContainer) quizContainer.innerHTML = `<div class="text-red-500 text-xl mt-12"><p>❌ لا توجد أسئلة كافية لهذا النوع من الاختبار.</p></div>`;
        return;
    }

    // خلط الأسئلة
    const seed = Math.floor(Math.random() * 1000000);

    function seededShuffle(array, currentSeed) {
        let arr = [...array], i = arr.length, j, temp;
        while (i) {
            j = (currentSeed + i) % i;
            i--;
            temp = arr[i];
            arr[i] = arr[j];
            arr[j] = temp;
        }
        return arr;
    }

    const shuffledQuestions = seededShuffle(sourceData, seed);
    
    // اختيار 10 أسئلة وتهيئة خلط الإجابات (فقط لأسئلة الاختيار المتعدد)
    selectedQuestions = shuffledQuestions.slice(0, QUIZ_LENGTH).map((q, index) => {
        if (type === 'tf') { 
            return q;
        }
        
        const answerSeed = seed * 10 + index;
        const answers = q.a.map((text, i) => ({ text, isCorrect: i === q.correct }));

        // خلط الإجابات
        let ansArr = [...answers], c = ansArr.length, r, t;
        while (c) {
            r = (answerSeed + c) % c;
            c--;
            t = ansArr[c];
            ansArr[c] = ansArr[r];
            ansArr[r] = t;
        }
        const newCorrectIndex = ansArr.findIndex(a => a.isCorrect);
        return {
            q: q.q,
            a: ansArr.map(a => a.text),
            correct: newCorrectIndex,
            info: q.info
        };
    });

    currentQuestionIndex = 0;
    score = 0;
    if (result) result.classList.add('hidden');
    if (timerElement) timerElement.classList.remove('hidden');
    if (progressBar) progressBar.classList.remove('hidden');
    
    // ابدأ أول سؤال بعد فترة قصيرة
    setTimeout(() => {
        if (loadingMessage) loadingMessage.classList.add('hidden');
        loadQuestion();
    }, 500); 
}

// *** 6. دوال تشغيل الاختبار ***

function loadQuestion() {
    clearInterval(questionTimer);
    if (nextButton) nextButton.classList.add('hidden');
    answered = false;

    if (currentQuestionIndex >= selectedQuestions.length) {
        showFinalResult();
        return;
    }

    const q = selectedQuestions[currentQuestionIndex];
    
    const btnClass = currentQuizType === 'tf' 
        ? 'col-span-1 answer-btn bg-red-600 hover:bg-red-500' 
        : 'col-span-1 answer-btn bg-emerald-700 hover:bg-emerald-600'; 

    const answersGridClass = currentQuizType === 'tf' 
        ? 'grid grid-cols-2 gap-6' 
        : 'grid grid-cols-1 md:grid-cols-2 gap-4';
        
    if (quizContainer) {
        quizContainer.innerHTML = `
            <div class="card question-card mt-6" style="opacity:1; transform:translateY(0);">
                <p class="text-xl md:text-2xl font-bold mb-6 text-yellow-300">
                    ${currentQuizType === 'mcq' ? 'اختيار متعدد' : 'صح أو خطأ'} - سؤال ${currentQuestionIndex + 1} من ${QUIZ_LENGTH}
                </p>
                <h2 class="text-2xl md:text-3xl font-extrabold mb-8">${q.q}</h2>
                <div id="answers-container" class="${answersGridClass}">
                    ${q.a.map((answer, index) => `<button class="${btnClass}" data-index="${index}">${answer}</button>`).join('')}
                </div>
                <div id="info-box" class="hidden text-sm mt-4"></div>
                <div class="timer-bar mt-6"><div id="timer-fill" class="timer-fill" style="transition:width ${TIME_PER_QUESTION}s linear;"></div></div>
            </div>
        `;
        document.querySelectorAll('.answer-btn').forEach(btn => btn.addEventListener('click', checkAnswer));
    }
    
    updateProgress();
    startQuestionTimer();
}

function startQuestionTimer() {
    let timeLeft = TIME_PER_QUESTION;
    const timerFill = document.getElementById('timer-fill');
    if (timerNumber) timerNumber.textContent = timeLeft;
    questionCountdown = timeLeft;
    
    if (timerFill) {
        timerFill.style.transition = 'none';
        timerFill.style.width = '100%';
        void timerFill.offsetWidth; 
        
        setTimeout(() => {
            timerFill.style.transition = `width ${TIME_PER_QUESTION}s linear`;
            timerFill.style.width = '0%';
        }, 50);
    }

    questionTimer = setInterval(() => {
        questionCountdown--;
        if (timerNumber) timerNumber.textContent = questionCountdown;
        if (questionCountdown <= 0) {
            clearInterval(questionTimer);
            handleTimeUp();
        }
    }, 1000);
}

function handleTimeUp() {
    if (!answered) {
        if (soundTimeUp) soundTimeUp.play().catch(() => {});
        answered = true;
        const q = selectedQuestions[currentQuestionIndex];
        const correctButton = document.querySelector(`.answer-btn[data-index="${q.correct}"]`);
        if (correctButton) correctButton.classList.add('correct');
        
        const infoBox = document.getElementById('info-box');
        if (infoBox) {
            infoBox.innerHTML = `**✨ معلومة إضافية:** ${q.info}`;
            infoBox.classList.remove('hidden');
        }
        
        if (result) {
            result.textContent = '⌛ انتهى الوقت! لم تحصل على نقطة.';
            result.className = 'mt-8 text-2xl md:text-3xl font-bold card p-5 bg-red-800 text-white';
            result.classList.remove('hidden');
        }
        if (nextButton) nextButton.classList.remove('hidden');
        
        totalAttempted++;
        totalWrong++;
        saveUserData();
    }
}

function checkAnswer(event) {
    if (answered) return;
    answered = true;
    clearInterval(questionTimer);
    const selectedButton = event.target;
    const selectedIndex = parseInt(selectedButton.dataset.index);
    const q = selectedQuestions[currentQuestionIndex];
    const isCorrect = selectedIndex === q.correct;
    const infoBox = document.getElementById('info-box');

    totalAttempted++;
    if (isCorrect) {
        score++;
        totalCorrect++;
        if (soundCorrect) soundCorrect.play().catch(() => {});
        if (result) {
            result.textContent = '✅ إجابة صحيحة!';
            result.className = 'mt-8 text-2xl md:text-3xl font-bold card p-5 bg-green-800 text-white';
        }
    } else {
        totalWrong++;
        if (soundWrong) soundWrong.play().catch(() => {});
        if (result) {
            result.textContent = `❌ إجابة خاطئة. الصحيحة: ${q.a[q.correct]}`;
            result.className = 'mt-8 text-2xl md:text-3xl font-bold card p-5 bg-red-800 text-white';
        }
    }
    saveUserData();

    document.querySelectorAll('.answer-btn').forEach(btn => {
        if (parseInt(btn.dataset.index) === q.correct) btn.classList.add('correct');
        else if (btn === selectedButton) btn.classList.add('wrong');
        btn.classList.add('answered');
    });

    if (infoBox) {
        infoBox.innerHTML = `**✨ معلومة إضافية:** ${q.info}`;
        infoBox.classList.remove('hidden');
    }
    if (result) result.classList.remove('hidden');
    if (nextButton) nextButton.classList.remove('hidden');
}

function updateProgress() {
    const percentage = (currentQuestionIndex / QUIZ_LENGTH) * 100;
    if (progressFill) progressFill.style.width = `${percentage}%`;
}

function showFinalResult() {
    if (progressFill) progressFill.style.width = '100%';
    if (quizContainer) quizContainer.innerHTML = '';
    if (timerElement) timerElement.classList.add('hidden');
    if (progressBar) progressBar.classList.add('hidden');

    const isMCQ = currentQuizType === 'mcq';
    let bestScore = isMCQ ? bestScoreMCQ : bestScoreTF;
    let storageKey = isMCQ ? 'bestScoreMCQ' : 'bestScoreTF';
    let quizTypeTitle = isMCQ ? 'الاختيار المتعدد' : 'الصح أو الخطأ';
    
    let isNewRecord = false;
    if (score > bestScore) {
        bestScore = score;
        localStorage.setItem(storageKey, bestScore);
        isNewRecord = true;
        if (isMCQ) bestScoreMCQ = score;
        else bestScoreTF = score;
        saveUserData(); 
    }

    const percentage = (score / QUIZ_LENGTH) * 100;
    let message = '';
    if (isNewRecord) message = "🏆 رقم قياسي جديد! تهانينا! 💯";
    else if (percentage === 100) message = "مبارك! 👑 الدرجة الكاملة! 💯";
    else if (percentage >= 70) message = `نتيجة ممتازة! ✨ ${score} من ${QUIZ_LENGTH}.`;
    else message = `نتيجتك هي: ${score} من ${QUIZ_LENGTH}. تحتاج إلى مراجعة بسيطة. 📚`;

    if (result) {
        result.innerHTML = `
            <p class="text-3xl md:text-4xl mb-4 text-[#66fcf1]">انتهت جولة ${quizTypeTitle}!</p>
            <p class="text-xl md:text-2xl font-bold mb-4">${message}</p>
            <p class="text-lg mb-2">نسبة النجاح: ${percentage.toFixed(2)}%</p>
            <p class="text-yellow-300 text-lg font-bold mb-4">أعلى نتيجة لـ ${username} في هذه الجولة: ${bestScore} من ${QUIZ_LENGTH}</p>
            <button id="return-to-welcome" class="main-btn mt-4">اختر تحدي جديد</button>
            <button id="show-profile-from-result" class="alt-btn mt-4">عرض ملفي الشخصي (الإحصائيات)</button>
            `;
        result.classList.remove('hidden');
        
        const returnBtn = document.getElementById('return-to-welcome');
        if (returnBtn) returnBtn.addEventListener('click', showWelcomeScreen);
        
        const profileBtn = document.getElementById('show-profile-from-result');
        if (profileBtn) profileBtn.addEventListener('click', showProfileScreen);
    }
}

// *** 7. وظيفة تشغيل الموسيقى/إيقافها ***
function toggleMusic() {
    const musicIcon = document.getElementById('music-icon'),
        musicStatus = document.getElementById('music-status');
    if (backgroundMusic && musicIcon && musicStatus) {
        if (backgroundMusic.paused) {
            backgroundMusic.play().catch(() => {
                console.log("Music Autoplay failed. Requires user interaction.");
            });
            musicIcon.textContent = '🎵';
            musicStatus.textContent = 'إيقاف';
        } else {
            backgroundMusic.pause();
            musicIcon.textContent = '🔇';
            musicStatus.textContent = 'تشغيل';
        }
    }
}

// *** 8. معالجات الأحداث والبدء ***

// معالج زر التسجيل (عند الضغط على "دخول وبدء التحدي")
if (startGameBtn) {
    startGameBtn.addEventListener('click', () => {
        username = usernameInput.value.trim();
        if (username.length < 2) {
            alert('الرجاء إدخال اسم مستخدم لا يقل عن حرفين.');
            return;
        }
        saveUserData();
        showWelcomeScreen(); // الانتقال إلى شاشة الترحيب
        // محاولة تشغيل الموسيقى عند بدء التحدي
        if (backgroundMusic && backgroundMusic.paused) {
            toggleMusic();
        }
    });
}

// معالج زر السؤال التالي
if (nextButton) {
    nextButton.addEventListener('click', () => {
        currentQuestionIndex++;
        if (result) result.classList.add('hidden');
        loadQuestion();
    });
}

// التحقق عند تحميل الصفحة لوجود اسم مستخدم محفوظ
document.addEventListener('DOMContentLoaded', () => {
    const savedUsername = localStorage.getItem('username');
    if (savedUsername) {
        username = savedUsername;
        if (usernameInput) usernameInput.value = savedUsername;
        bestScoreMCQ = parseInt(localStorage.getItem('bestScoreMCQ') || '0');
        bestScoreTF = parseInt(localStorage.getItem('bestScoreTF') || '0');
        
        // إذا كان الاسم محفوظاً، ننتقل مباشرة إلى شاشة الترحيب
        if (loginScreen) loginScreen.classList.add('hidden');
        showWelcomeScreen();
    }
    
    if (musicToggleButton) {
        musicToggleButton.addEventListener('click', toggleMusic);
    }
    
    // محاولة تشغيل الموسيقى عند تحميل الصفحة 
    if (backgroundMusic) {
        backgroundMusic.play().catch(() => {
            console.log("Autoplay failed.");
        });
    }

    // ملاحظة: أزرار التحديات والملف الشخصي يتم ربطها الآن داخل دالة showWelcomeScreen() 
    // لضمان وجود شاشة الترحيب في DOM أولاً.
});
