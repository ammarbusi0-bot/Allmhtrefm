<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحدي الأسئلة الدينية - إثراء</title>
    
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            text-align: right;
            line-height: 1.6;
        }
        .container {
            background-color: #fff;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
            margin: auto;
        }
        
        /* تغيير لون العناوين إلى الأخضر للتصميم القديم */
        h1, h2, h3 {
            color: #28a745; /* اللون الأخضر */
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        /* خلفية شاشات البداية */
        #welcomeScreen, #modeSelectionScreen {
            background-color: #e6ffe6; /* لون أخضر فاتح للخلفية */
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
            text-align: center;
        }
        
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            background-color: #eaf6ff;
            padding: 15px;
            border-radius: 8px;
            border-right: 5px solid #007bff;
        }
        .options-list {
            list-style: none;
            padding: 0;
        }
        .option-button {
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
            padding: 12px 15px;
            margin: 8px 0;
            width: 100%;
            text-align: right;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            font-size: 1em;
            display: block; 
        }
        .option-button:hover:not(:disabled) {
            background-color: #e0e0e0;
            transform: translateY(-2px);
        }
        .option-button.correct {
            background-color: #28a745;
            color: white;
            border-color: #218838;
        }
        .option-button.incorrect {
            background-color: #dc3545;
            color: white;
            border-color: #c82333;
        }
        .option-button:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        
        /* تصميم الأزرار (أخضر وأزرق كما كان في النسخ القديمة) */
        .nav-btn, .mode-select-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
            margin: 5px;
        }
        #nextBtn, #continueBtn, #restartBtn {
            background-color: #007bff; /* أزرق */
            color: white;
        }
        #nextBtn:hover, #continueBtn:hover, #restartBtn:hover {
            background-color: #0056b3;
        }
        #startNormalBtn {
            background-color: #28a745; /* أخضر */
            color: white;
        }
        #startNormalBtn:hover {
            background-color: #1e7e34;
        }
        #startBlitzBtn {
            background-color: #ffc107; /* أصفر (لوضع مختلف) */
            color: #333;
        }
        #startBlitzBtn:hover {
            background-color: #e0a800;
        }
        #resetBtn, #backToProfileBtn {
            background-color: #6c757d;
            color: white;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* تصميم قسم الملف الشخصي والروابط */
        .section-container {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin-top: 20px;
        }
        .input-group label {
            font-weight: bold;
            color: #555;
        }
        #socialLinks a {
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        #socialLinks a:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="welcomeScreen">
            <h1>مرحباً بك في تحدي إثراء الديني!</h1>
            
            <div id="userProfileSection" class="section-container">
                <h2>يرجى إدخال بياناتك للمتابعة</h2>
                
                <div class="input-group">
                    <label for="usernameInput" style="display: block; margin-bottom: 5px;">اسم المستخدم:</label>
                    <input type="text" id="usernameInput" placeholder="أدخل اسم المستخدم" style="padding: 10px; margin-bottom: 15px; width: 80%; max-width: 300px; border: 1px solid #ccc; border-radius: 5px;">
                </div>
                <div class="input-group">
                    <label for="passwordInput" style="display: block; margin-bottom: 5px;">كلمة السر:</label>
                    <input type="password" id="passwordInput" placeholder="أدخل كلمة السر" style="padding: 10px; margin-bottom: 20px; width: 80%; max-width: 300px; border: 1px solid #ccc; border-radius: 5px;">
                </div>
                
                <button id="continueBtn" class="nav-btn">المتابعة لاختيار الوضع</button>

                <h3>روابط حساباتي</h3>
                <div id="socialLinks" style="margin-top: 15px;">
                    <a href="رابط_حسابك_على_انستجرام" target="_blank" style="margin: 0 10px; color: #E1306C; text-decoration: none; font-weight: bold;">انستجرام</a> |
                    <a href="رابط_حسابك_على_تويتر_أو_X" target="_blank" style="margin: 0 10px; color: #1DA1F2; text-decoration: none; font-weight: bold;">تويتر/X</a> |
                    <a href="رابط_حسابك_على_تيك_توك" target="_blank" style="margin: 0 10px; color: #000; text-decoration: none; font-weight: bold;">تيك توك</a>
                </div>
            </div>
            
            <div id="videoContainer" class="section-container" style="text-align: center; margin-top: 30px;">
                <h3>فيديو مهم</h3>
                <video width="100%" controls poster="صورة_غلاف_الفيديو_إن_وجدت.jpg">
                    <source src="VID_20251027_220735_527.mp4" type="video/mp4">
                    متصفحك لا يدعم وسم الفيديو.
                </video>
            </div>
        </div>
        
        <div id="modeSelectionScreen" class="hidden container">
            <h2 style="text-align: center;">اختر وضع اللعب</h2>
            <p style="text-align: center;">أهلاً بك يا <span id="displayedUsername" style="font-weight: bold; color: #dc3545;">[اسم المستخدم]</span>، تفضل باختيار تحديك:</p>
            <div class="mode-selection" style="text-align: center;">
                <button id="startNormalBtn" class="mode-select-btn">تحدي عادي (10 أسئلة)</button>
                <button id="startBlitzBtn" class="mode-select-btn">تحدي السرعة (60 ثانية)</button>
            </div>
             <button id="backToProfileBtn" class="nav-btn" style="margin-top: 20px;">العودة لبيانات الدخول</button>
        </div>
        
        <div id="quizContainer" class="hidden">
            <h2 id="modeTitle">التحدي العادي</h2>
            
            <div id="timerBar" class="hidden">
                <div id="timerProgress"></div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <button id="fiftyFiftyBtn">50/50 (مرة واحدة)</button>
                <div id="currentQuestionInfo"></div>
            </div>
            
            <p id="questionText" class="question-text"></p>
            <ul id="optionsList" class="options-list">
                </ul>
            
            <div class="navigation-controls">
                <button id="resetBtn" class="nav-btn">العودة للرئيسية</button>
                <button id="nextBtn" class="nav-btn">السؤال التالي</button>
            </div>
        </div>

        <div id="resultScreen" class="hidden">
            <h2>نتائج التحدي</h2>
            <p id="scoreText" class="final-score"></p>
            <p id="correctAnswersInfo"></p>
            <p id="wrongAnswersInfo"></p>
            <button id="restartBtn" class="nav-btn" style="margin-top: 20px;">بدء تحدي جديد</button>
        </div>
    </div>

    <script>
        // المتغيرات العامة
        const welcomeScreen = document.getElementById('welcomeScreen');
        const modeSelectionScreen = document.getElementById('modeSelectionScreen'); // الشاشة الجديدة
        const quizContainer = document.getElementById('quizContainer');
        const resultScreen = document.getElementById('resultScreen');
        const startNormalBtn = document.getElementById('startNormalBtn');
        const startBlitzBtn = document.getElementById('startBlitzBtn');
        const modeTitle = document.getElementById('modeTitle');
        const questionText = document.getElementById('questionText');
        const optionsList = document.getElementById('optionsList');
        const nextBtn = document.getElementById('nextBtn');
        const resetBtn = document.getElementById('resetBtn');
        const restartBtn = document.getElementById('restartBtn');
        const scoreText = document.getElementById('scoreText');
        const correctAnswersInfo = document.getElementById('correctAnswersInfo');
        const wrongAnswersInfo = document.getElementById('wrongAnswersInfo');
        const currentQuestionInfo = document.getElementById('currentQuestionInfo');
        const timerBar = document.getElementById('timerBar');
        const timerProgress = document.getElementById('timerProgress');
        const fiftyFiftyBtn = document.getElementById('fiftyFiftyBtn');
        
        // متغيرات شاشة الدخول الجديدة
        const continueBtn = document.getElementById('continueBtn');
        const displayedUsername = document.getElementById('displayedUsername');
        const usernameInput = document.getElementById('usernameInput');
        const backToProfileBtn = document.getElementById('backToProfileBtn');

        let allQuestions = [];
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let currentMode = 'normal';
        let isAnswered = false;
        
        // المتغيرات الخاصة بوضع السرعة
        const BLITZ_TIME = 60; 
        let timeLeft = BLITZ_TIME;
        let timerInterval;

        // المتغيرات الخاصة بخاصية 50/50
        let fiftyFiftyUsed = false;
        
        // الحد الأقصى للأسئلة لكل وضع
        const MAX_QUESTIONS_NORMAL = 10;
        const MAX_QUESTIONS_BLITZ = 10;

        // ------------------------------------------------
        // 1. البيانات (الأسئلة مدمجة هنا)
        // ------------------------------------------------
        const loadQuestions = () => {
            allQuestions = [
                // السؤال 1
                { "q": "في الفقه الإسلامي، ما هو الحكم الشرعي لبيع 'العِينة'؟", "a": ["حرام", "جائز بشروط", "مكروه", "مباح"], "correct": 0, "info": "بيع العِينة هو بيع السلعة بثمن مؤجل ثم شراؤها نقداً بثمن أقل، وهو نوع من الاحتيال على الربا، وحكمه التحريم عند جمهور الفقهاء." },
                // السؤال 2
                { "q": "ما هو أقل النصاب الذي تجب فيه زكاة الذهب؟", "a": ["20 مثقالاً (حوالي 85 جراماً)", "10 مثاقيل", "30 مثقالاً", "50 جراماً"], "correct": 0, "info": "نصاب الذهب هو 20 مثقالاً، وهو ما يعادل تقريباً 85 جراماً من الذهب الخالص." },
                // السؤال 3
                { "q": "ما هو اليوم الذي يُستحب صومه في الأسبوع ويُعرف باسم 'يوم تُرفع فيه الأعمال'؟", "a": ["الإثنين والخميس", "الجمعة", "السبت", "الثلاثاء والأربعاء"], "correct": 0, "info": "يوم الإثنين والخميس هما اليومان اللذان تُعرض فيهما أعمال العباد على الله، ويُستحب صومهما." },
                // السؤال 4
                { "q": "كم عدد الصلوات المفروضة التي تُصلى جهراً (قراءة الإمام بصوت عالٍ)؟", "a": ["3 صلوات (المغرب والعشاء والصبح)", "5 صلوات", "صلاتان فقط (المغرب والعشاء)", "4 صلوات (باستثناء الظهر والعصر)"], "correct": 0, "info": "الصلوات الجهرية هي المغرب (أول ركعتين)، العشاء (أول ركعتين)، والصبح (الركعتان كاملتان). المجموع 3 صلوات." },
                // السؤال 5
                { "q": "في علم الحديث، ما هو تصنيف الحديث الذي رواه عدد كثير عن مثلهم، ويستحيل عادةً تواطؤهم على الكذب؟", "a": ["الحديث المتواتر", "الحديث الآحاد", "الحديث المشهور", "الحديث الصحيح"], "correct": 0, "info": "الحديث المتواتر هو ما رواه جمعٌ عن جمع تُحيل العادة تواطؤهم على الكذب." },
                // السؤال 6
                { "q": "ما هي السورة التي كان النبي صلى الله عليه وسلم يقرأ بها في ركعتي سنة الفجر بعد سورة الفاتحة؟", "a": ["الكافرون والإخلاص", "الإخلاص والفلق", "الضحى والشرح", "الملك والسجدة"], "correct": 0, "info": "كان يقرأ في الركعة الأولى بعد الفاتحة بـ 'قل يا أيها الكافرون' وفي الثانية بـ 'قل هو الله أحد'." },
                // السؤال 7
                { "q": "ما هي العقوبة المقررة شرعاً لمن شرب الخمر باتفاق المذاهب الأربعة؟", "a": ["الجلد", "السجن", "التعزير", "القتل"], "correct": 0, "info": "العقوبة المقررة هي الجلد، واختلفوا في عدد الجلدات (80 جلدة أو 40 جلدة)." },
                // السؤال 8
                { "q": "من هو الصحابي الجليل الملقب بـ 'سيف الله المسلول'؟", "a": ["خالد بن الوليد", "حمزة بن عبد المطلب", "عمر بن الخطاب", "علي بن أبي طالب"], "correct": 0, "info": "هو الصحابي القائد خالد بن الوليد." },
                // السؤال 9
                { "q": "ما هو الاسم الذي يطلق على التابعين الذين أدركوا الصحابة ولكن لم يروا النبي صلى الله عليه وسلم؟", "a": ["التابعون", "الأتباع", "المخضرمون", "الأولياء"], "correct": 0, "info": "التابعون هم من لقوا الصحابة وعاشوا بعد عصر النبوة." },
                // السؤال 10
                { "q": "ما هي الجهة التي يُصرف فيها ثُلثا زكاة الفطر عند المالكية؟", "a": ["الفقراء والمساكين", "ابن السبيل والغارمون", "المؤلفة قلوبهم", "العاملون عليها"], "correct": 0, "info": "تُصرف زكاة الفطر على الفقراء والمساكين فقط عند المالكية (بخلاف زكاة المال)." },
                // ... (هنا يمكنك إضافة الـ 70 سؤالًا المتبقية) ...
            ];
        };
        
        // ------------------------------------------------
        // 2. دوال التوقيت (لوضع السرعة)
        // ------------------------------------------------
        const startTimer = () => {
            timeLeft = BLITZ_TIME;
            timerBar.classList.remove('hidden');
            timerProgress.style.width = '100%';
            
            clearInterval(timerInterval); 
            timerInterval = setInterval(() => {
                timeLeft--;
                const percentage = (timeLeft / BLITZ_TIME) * 100;
                timerProgress.style.width = `${percentage}%`;
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endQuiz();
                }
            }, 1000);
        };

        const stopTimer = () => {
            clearInterval(timerInterval);
            timerBar.classList.add('hidden');
        };

        // ------------------------------------------------
        // 3. منطق اللعبة
        // ------------------------------------------------
        const initializeQuestions = (mode) => {
            let maxQuestions = mode === 'normal' ? MAX_QUESTIONS_NORMAL : MAX_QUESTIONS_BLITZ;
            
            // خلط الأسئلة واختيار العدد المطلوب
            currentQuestions = allQuestions.sort(() => 0.5 - Math.random()).slice(0, maxQuestions);
            
            currentQuestionIndex = 0;
            score = 0;
            isAnswered = false;
            fiftyFiftyUsed = false;
            
            // إظهار زر 50/50 وتفعيله
            fiftyFiftyBtn.classList.remove('hidden');
            fiftyFiftyBtn.disabled = false;
            
            if (mode === 'blitz') {
                startTimer();
            }

            loadQuestion();
        };

        const loadQuestion = () => {
            if (currentQuestionIndex >= currentQuestions.length) {
                endQuiz();
                return;
            }

            const q = currentQuestions[currentQuestionIndex];
            questionText.textContent = q.q;
            optionsList.innerHTML = ''; 
            isAnswered = false;
            
            // تحديث رقم السؤال
            currentQuestionInfo.textContent = `السؤال ${currentQuestionIndex + 1} من ${currentQuestions.length}`;

            // خلط الأجوبة
            const shuffledOptions = q.a.map((answer, index) => ({ answer, index })).sort(() => 0.5 - Math.random());

            shuffledOptions.forEach(option => {
                const li = document.createElement('li');
                const button = document.createElement('button');
                button.className = 'option-button';
                button.textContent = option.answer;
                button.dataset.originalIndex = option.index; 
                
                button.addEventListener('click', () => checkAnswer(button, q.correct));
                li.appendChild(button);
                optionsList.appendChild(li);
            });
            
            // إظهار زر "التالي" لوضع "العادي" فقط
            if (currentMode === 'normal') {
                nextBtn.classList.remove('hidden');
                nextBtn.disabled = true;
            } else {
                nextBtn.classList.add('hidden');
            }
        };

        const checkAnswer = (selectedButton, correctIndex) => {
            if (isAnswered) return;
            isAnswered = true;

            const allButtons = optionsList.querySelectorAll('.option-button');
            const selectedOriginalIndex = parseInt(selectedButton.dataset.originalIndex);

            allButtons.forEach(btn => {
                btn.disabled = true; 
                const btnOriginalIndex = parseInt(btn.dataset.originalIndex);

                if (btnOriginalIndex === correctIndex) {
                    btn.classList.add('correct'); 
                } else if (btn === selectedButton) {
                    btn.classList.add('incorrect'); 
                }
            });

            // تحديث النتيجة
            if (selectedOriginalIndex === correctIndex) {
                score++;
            }

            // لوضع "العادي" نفعّل زر "التالي"
            if (currentMode === 'normal') {
                nextBtn.disabled = false;
            } else {
                 // لوضع "السرعة" ننتقل تلقائياً بعد ثانية
                 setTimeout(moveToNextQuestion, 1000);
            }
        };

        const moveToNextQuestion = () => {
            currentQuestionIndex++;
            loadQuestion();
        };

        const endQuiz = () => {
            stopTimer();
            quizContainer.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            
            const totalQuestions = currentQuestions.length;
            const wrongAnswers = totalQuestions - score;
            
            scoreText.textContent = `نتيجتك النهائية: ${score} من ${totalQuestions}`;
            correctAnswersInfo.textContent = `الإجابات الصحيحة: ${score}`;
            wrongAnswersInfo.textContent = `الإجابات الخاطئة: ${wrongAnswers}`;
        };

        // ------------------------------------------------
        // 4. خاصية 50/50
        // ------------------------------------------------
        const useFiftyFifty = () => {
            if (fiftyFiftyUsed || isAnswered) return;
            
            fiftyFiftyUsed = true;
            fiftyFiftyBtn.disabled = true;
            
            const q = currentQuestions[currentQuestionIndex];
            const correctIndex = q.correct;
            const allButtons = optionsList.querySelectorAll('.option-button');
            
            let incorrectIndices = [];
            allButtons.forEach((btn, index) => {
                if (parseInt(btn.dataset.originalIndex) !== correctIndex) {
                    incorrectIndices.push(index);
                }
            });
            
            // اختيار إجابة خاطئة عشوائية لحذفها (نترك الإجابة الصحيحة وإجابة خاطئة واحدة)
            incorrectIndices.sort(() => 0.5 - Math.random()).slice(0, incorrectIndices.length - 1).forEach(index => {
                allButtons[index].parentElement.classList.add('hidden');
            });
        };

        // ------------------------------------------------
        // 5. إدارة التنقل بين الشاشات والأزرار
        // ------------------------------------------------
        
        // تبدأ اللعبة من شاشة اختيار الوضع
        const startQuiz = (mode) => {
            currentMode = mode;
            modeTitle.textContent = mode === 'normal' ? 'التحدي العادي (10 أسئلة)' : 'تحدي السرعة (60 ثانية)';
            
            modeSelectionScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            quizContainer.classList.remove('hidden');
            
            if (mode === 'blitz') {
                timerBar.classList.remove('hidden');
            } else {
                timerBar.classList.add('hidden');
            }
            
            initializeQuestions(mode); 
        };

        // العودة إلى الشاشة الرئيسية (إدخال البيانات)
        const resetQuiz = () => {
            stopTimer();
            quizContainer.classList.add('hidden');
            resultScreen.classList.add('hidden');
            welcomeScreen.classList.remove('hidden'); // إظهار شاشة الدخول أولاً
            modeSelectionScreen.classList.add('hidden');
        };
        
        // ربط الأحداث بالأزرار
        
        // 1. زر المتابعة (من شاشة الدخول إلى شاشة اختيار الوضع)
        continueBtn.addEventListener('click', () => {
            const currentUsername = usernameInput.value || 'زائر كريم';
            displayedUsername.textContent = currentUsername;
            
            welcomeScreen.classList.add('hidden');
            modeSelectionScreen.classList.remove('hidden');
        });
        
        // 2. أزرار وضع اللعب (من شاشة اختيار الوضع إلى شاشة اللعبة)
        startNormalBtn.addEventListener('click', () => startQuiz('normal'));
        startBlitzBtn.addEventListener('click', () => startQuiz('blitz'));
        
        // 3. زر العودة (من شاشة اختيار الوضع إلى شاشة الدخول)
        backToProfileBtn.addEventListener('click', () => {
            modeSelectionScreen.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
        });

        nextBtn.addEventListener('click', moveToNextQuestion);
        resetBtn.addEventListener('click', resetQuiz);
        restartBtn.addEventListener('click', resetQuiz);
        fiftyFiftyBtn.addEventListener('click', useFiftyFifty);

        // تحميل البيانات عند فتح الصفحة لأول مرة
        loadQuestions(); 

    </script>
</body>
</html>
