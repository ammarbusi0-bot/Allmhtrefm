<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>๐ก ุชุญุฏู ุงููุนุฑูุฉ ุงูุฅุณูุงููุฉ - ููู ูุฃุณุฆูุฉ ูุชููุนุฉ</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ููุฏ ุงูุชุตููู CSS */
body {font-family:'Amiri',serif;background:linear-gradient(to bottom,#0d1b1e,#0c2c24);color:#f8f9fa;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:1.5rem;}
.container {max-width:48rem;width:100%;margin-top:1rem;}
.question-card {background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);border-radius:1.5rem;box-shadow:0 4px 20px rgba(255,215,0,0.2);transition:transform 0.3s ease, box-shadow 0.3s ease,opacity 0.4s ease;opacity:0;animation:fadeIn 0.5s forwards;padding:1.5rem;}
@keyframes fadeIn {from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);}}
.answer-btn {transition:all 0.3s ease;text-align:center;border:2px solid transparent;white-space:normal;line-height:1.3;min-height:50px;display:flex;align-items:center;justify-content:center;background-color:#059669;}
.answer-btn:not(.correct):not(.wrong):hover {background-color:#047857;transform:scale(1.02);}
.correct {background-color:#10B981!important;border-color:#059669!important;pointer-events:none;}
.wrong {background-color:#EF4444!important;border-color:#DC2626!important;pointer-events:none;}
.answered {pointer-events:none;}
.progress-bar {height:8px;background:rgba(255,255,255,0.2);border-radius:4px;overflow:hidden;margin:1rem 0;}
.progress-fill {height:100%;background:linear-gradient(to right,#f59e0b,#eab308);transition:width 0.5s ease;}
.timer-bar {height:8px;background:#FEE715;border-radius:4px;overflow:hidden;margin-bottom:0.5rem;box-shadow:0 0 10px rgba(255,255,255,0.3);}
.timer-fill {height:100%;background:#F97316;width:100%;transition:width 15s linear;}
#timer {margin-top:0.5rem;}
#timer-number {font-weight:bold;}
#info-box {background:rgba(255, 255, 255, 0.1); padding:1rem; border-radius:1rem; margin-top:1rem; text-align:right;}
.video-container {display: flex;justify-content: center;margin-bottom: 2rem;padding: 0 1rem;max-width: 100%;}
.video-container video {max-width: 100%;height: auto;border-radius: 1rem;box-shadow: 0 4px 20px rgba(255,215,0,0.3);}

/* ุชุตููู ุฒุฑ ุงููุณุงุนุฏุฉ 50/50 */
#fifty-fifty-btn:not(:disabled) {background-color:#8B5CF6;transition:background-color 0.3s, transform 0.2s;}
#fifty-fifty-btn:not(:disabled):hover {background-color:#7C3AED;transform:scale(1.03);}
#fifty-fifty-btn:disabled {background-color:#4B5563;cursor:not-allowed;}
</style>
</head>
<body class="text-center">

<header class="mb-8 w-full max-w-4xl">
<h1 class="text-4xl md:text-5xl font-extrabold text-yellow-300 mb-2">๐ก ุชุญุฏู ุงููุนุฑูุฉ ุงูุฅุณูุงููุฉ</h1>
<p class="text-gray-300 text-lg">ุงุฎุชุจุฑ ูุนูููุงุชู ุงูุฏูููุฉ ูุงูููููุฉ โ 10 ุฃุณุฆูุฉ ุฌุฏูุฏุฉ ูู ุฌููุฉ</p>

<audio id="background-music" src="https://assets.mixkit.co/sfx/preview/mixkit-lo-fi-hip-hop-loop-803.mp3" loop autoplay></audio> 
<button id="music-toggle-btn" class="mt-3 text-sm font-semibold text-gray-300 hover:text-yellow-400 transition flex items-center justify-center mx-auto">
    <span id="music-icon" class="ml-1">๐ต</span>
    <span id="music-status">ุฅููุงู</span>
</button>
</header>

<div class="progress-bar w-full max-w-4xl">
<div id="progress-fill" class="progress-fill" style="width: 0%"></div>
</div>

<main id="quiz" class="container">
    <div id="welcome-screen" class="question-card mt-6 p-8" style="opacity:1; transform:translateY(0);">
        <p id="welcome-message-text" class="text-3xl font-extrabold text-yellow-300 mb-4">ุฃููุงู ุจู ูู ุชุญุฏู ุงููุนุฑูุฉ ุงูุฅุณูุงููุฉ!</p>
        <p class="text-xl text-gray-200 mb-6">ุงุฎุชุจุฑ ูุนูููุงุชู ูู ุงูููู ูุงูุชุงุฑูุฎ ุงูุฅุณูุงูู.</p>

        <div id="login-form">
            <input type="text" id="player-name-input" placeholder="ุฃุฏุฎู ุงุณูู ุงููุฑูู" 
                   class="w-full p-3 mb-4 text-lg text-gray-900 bg-gray-200 rounded-lg border border-gray-400 text-right focus:outline-none focus:ring-2 focus:ring-yellow-500" dir="rtl">
            
            <input type="password" id="player-pass-input" placeholder="ูููุฉ ุงููุฑูุฑ (ุงุฎุชูุงุฑู - 1234)" 
                   class="w-full p-3 mb-6 text-lg text-gray-900 bg-gray-200 rounded-lg border border-gray-400 text-right focus:outline-none focus:ring-2 focus:ring-yellow-500" dir="rtl">
            
            <p id="error-message" class="text-red-400 mb-4 hidden">ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณู ุงููุงุนุจ.</p>
        </div>

        <button id="start-quiz-btn" class="bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold py-3 px-8 rounded-full text-xl transition shadow-lg">
            ุงุจุฏุฃ ุงูุชุญุฏู ุงูุขู โจ
        </button>
    </div>
    </main>
<div id="result" class="mt-6 text-2xl md:text-3xl font-bold hidden p-4 rounded-xl shadow-2xl"></div>
<button id="next-btn" class="mt-6 hidden bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold py-3 px-6 rounded-full text-xl transition shadow-lg">ุงูุณุคุงู ุงูุชุงูู โก๏ธ</button>

<div id="quiz-controls" class="w-full max-w-4xl flex justify-between items-center mt-4">
    <div id="timer" class="text-gray-300 text-sm hidden">
      <p>ููุช ุงูุณุคุงู: <span id="timer-number">15</span> ุซุงููุฉ</p>
    </div>
    <button id="fifty-fifty-btn" class="hidden text-white font-bold py-2 px-4 rounded-full text-md transition shadow-lg flex items-center">
        <span id="fifty-fifty-count" class="ml-1 text-lg font-extrabold">1</span>
        <i class="fas fa-magic"></i>
        <span class="mr-2">50/50</span>
    </button>
</div>

<audio id="sound-correct" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="sound-wrong" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
<audio id="sound-timeup" src="https://actions.google.com/sounds/v1/cartoon/pop.ogg"></audio>

<footer class="mt-12 w-full max-w-4xl border-t border-gray-700 pt-8">
    <h3 class="text-2xl font-bold text-yellow-300 mb-6">ุชูุงุตู ูุนูุง ูุชุงุจุน ุฌุฏูุฏูุง</h3>
    
    <div class="flex flex-wrap justify-center gap-6">
        
        <a href="https://wa.me/905510651347" target="_blank" 
           class="flex items-center space-x-2 space-x-reverse bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-full transition shadow-lg w-full sm:w-auto justify-center">
            <i class="fab fa-whatsapp text-2xl"></i>
            <span class="text-lg">ุชูุงุตู ูุงุชุณุงุจ (ุชุฑููุง)</span>
        </a>
        
        <a href="https://t.me/bootcadid" target="_blank" 
           class="flex items-center space-x-2 space-x-reverse bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-full transition shadow-lg w-full sm:w-auto justify-center">
            <i class="fab fa-telegram-plane text-2xl"></i>
            <span class="text-lg">ููุงุฉ ุงูุชูุฌุฑุงู ูููุชุงุจุนุฉ</span>
        </a>
        
        <a href="https://tiktok.com/@allmhtref" target="_blank" 
           class="flex items-center space-x-2 space-x-reverse bg-gray-800 hover:bg-gray-900 text-white font-semibold py-3 px-6 rounded-full transition shadow-lg w-full sm:w-auto justify-center">
            <i class="fab fa-tiktok text-2xl"></i>
            <span class="text-lg">ุชุงุจุนูุง ุนูู ุชูู ุชูู</span>
        </a>
        
        <a href="mailto:ammarbusi338@gmail.com"
           class="flex items-center space-x-2 space-x-reverse bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-full transition shadow-lg w-full sm:w-auto justify-center">
            <i class="fas fa-envelope text-2xl"></i>
            <span class="text-lg">ููุชูุงุตู ุนุจุฑ ุงูุฅูููู</span>
        </a>
        
    </div>
    
    <button onclick="localStorage.removeItem('playerName'); window.location.reload();" class="mt-6 text-md text-red-400 hover:text-red-200 block mx-auto">ุชุณุฌูู ุงูุฎุฑูุฌ ูู ุงูููู ุงูุญุงูู</button>
</footer>


<script>
// *** ุฅุนุฏุงุฏุงุช ุงูุงุฎุชุจุงุฑ ***
const QUIZ_LENGTH=10, TIME_PER_QUESTION=15; 

// ๐ฅ ูุตูููุฉ ุงูุฃุณุฆูุฉ ุงููุฏูุฌุฉ ๐ฅ
const ALL_QUESTIONS = [
    {
        "q": "ูุง ูู ุฃูู ุบุฒูุฉ ุฎุงุถูุง ุงููุณูููู ูู ุงูุฅุณูุงูุ",
        "a": ["ุบุฒูุฉ ุฃุญุฏ", "ุบุฒูุฉ ุจุฏุฑ ุงููุจุฑู", "ุบุฒูุฉ ุงูุฎูุฏู", "ุบุฒูุฉ ุชุจูู"],
        "correct": 1,
        "info": "ุฃูู ุบุฒูุฉ ูุจุฑู ูุงุตูุฉ ูุงูุช ุบุฒูุฉ ุจุฏุฑ ุงููุจุฑู ูู 17 ุฑูุถุงูุ ุงูุณูุฉ ุงูุซุงููุฉ ูููุฌุฑุฉ."
    },
    {
        "q": "ูุง ูู ุฃูู ุนุฏุฏ ุฑูุนุงุช ูุตูุงุฉ ุงููุชุฑ ุนูุฏ ุฌูููุฑ ุงููููุงุกุ",
        "a": ["ุซูุงุซ ุฑูุนุงุช", "ุฎูุณ ุฑูุนุงุช", "ุฑูุนุฉ ูุงุญุฏุฉ", "ุฑูุนุชุงู"],
        "correct": 2,
        "info": "ูุฌูุฒ ุฃู ูุตูู ุงููุชุฑ ุจุฑูุนุฉ ูุงุญุฏุฉุ ููู ุงูุฑูุนุฉ ุงูุชู ูุฎุชู ุจูุง ุตูุงุฉ ุงูููู."
    },
    {
        "q": "ูู ูู ุงูุตุญุงุจู ุงูุฌููู ุงูุฐู ููุจ ุจุณูุฏ ุงููุฑุงุกุ",
        "a": ["ุนุจุฏุงููู ุจู ูุณุนูุฏ", "ุฃุจู ุจู ูุนุจ", "ูุนุงุฐ ุจู ุฌุจู", "ุณุนุฏ ุจู ุฃุจู ููุงุต"],
        "correct": 1,
        "info": "ุฃุจู ุจู ูุนุจ ุฑุถู ุงููู ุนูู ูู ุณูุฏ ุงููุฑุงุกุ ููุงู ูู ูุชุจุฉ ุงููุญู."
    },
    {
        "q": "ูุชู ูุฌูุฒ ูููุณุงูุฑ ุฃู ููุตุฑ ุงูุตูุงุฉ ุงูุฑุจุงุนูุฉุ",
        "a": ["ุจุนุฏ ุฃู ููุทุน 10 ูู", "ุจุนุฏ ููุงุฑูุฉ ุญุฏูุฏ ุจูุฏุชู", "ุจูุฌุฑุฏ ููุฉ ุงูุณูุฑ", "ูุง ูุฌูุฒ ูู ุงููุตุฑ ุฅูุง ูู ุงูุณูุฑ ุงูุทููู ุฌุฏุงู"],
        "correct": 1,
        "info": "ูุจุฏุฃ ุงููุตุฑ ูุงูุฌูุน ุจุนุฏ ููุงุฑูุฉ ุงูุนุงูุฑ ูู ุงูุจูุฏุฉุ ููุง ูุดุชุฑุท ูู ูู ุงููุฐุงูุจ ูุณุงูุฉ ูุญุฏุฏุฉ ููุจุฏุก."
    },
    {
        "q": "ูู ูู ุฃูู ุฎูููุฉ ุฃูููุ",
        "a": ["ูุนุงููุฉ ุจู ุฃุจู ุณููุงู", "ุนุจุฏ ุงูููู ุจู ูุฑูุงู", "ุงููููุฏ ุจู ุนุจุฏ ุงูููู", "ุนูุฑ ุจู ุนุจุฏ ุงูุนุฒูุฒ"],
        "correct": 0,
        "info": "ูู ูุนุงููุฉ ุจู ุฃุจู ุณููุงู ุฑุถู ุงููู ุนููุ ูุคุณุณ ุงูุฏููุฉ ุงูุฃูููุฉ ุจุนุฏ ุชูุงุฒู ุงูุญุณู ุจู ุนูู ุนู ุงูุฎูุงูุฉ."
    },
    {
        "q": "ูู ุนุฏุฏ ุฃุฑูุงู ุงูุฅููุงูุ",
        "a": ["ุซูุงุซุฉ", "ุฎูุณุฉ", "ุณุจุนุฉ", "ุณุชุฉ"],
        "correct": 3,
        "info": "ุฃุฑูุงู ุงูุฅููุงู ูู ุณุชุฉ: ุงูุฅููุงู ุจุงูููุ ูููุงุฆูุชูุ ููุชุจูุ ูุฑุณููุ ูุงูููู ุงูุขุฎุฑุ ูุจุงููุฏุฑ ุฎูุฑู ูุดุฑู."
    },
    {
        "q": "ูุง ูู ุงูุงุณู ุงูุขุฎุฑ ูุณูุฑุฉ (ุงูุฏูุฑ)ุ",
        "a": ["ุณูุฑุฉ ุงูุฅูุณุงู", "ุณูุฑุฉ ุงููุฏุซุฑ", "ุณูุฑุฉ ุงูููุงูุฉ", "ุณูุฑุฉ ุงููุงุฑุนุฉ"],
        "correct": 0,
        "info": "ุณูุฑุฉ ุงูุฏูุฑ ูู ููุณูุง ุณูุฑุฉ ุงูุฅูุณุงูุ ูุชุณูู ุฃูุถุงู 'ูู ุฃุชู'."
    },
    {
        "q": "ูุง ูู ุงููุตุทูุญ ุงููููู ุงูุฐู ูุนูู ุนุฏู ูุฌูุฏ ุงููุงุก ุงููุงูู ููุทูุงุฑุฉุ",
        "a": ["ุงูุญูุถ", "ุงูุฌูุงุจุฉ", "ููุฏ ุงูุทููุฑูู", "ุงูุญุฏุซ ุงูุฃุตุบุฑ"],
        "correct": 2,
        "info": "ููุฏ ุงูุทููุฑูู (ุงููุงุก ูุงูุชุฑุงุจ) ูู ุงูุญุงูุฉ ุงูุชู ูุง ูุฌุฏ ูููุง ุงููุณูู ูุงุก ููุง ุชุฑุงุจุงู."
    },
    {
        "q": "ูุง ูู ุฃูู ุนุงุตูุฉ ุฅุณูุงููุฉุ",
        "a": ["ุงููุฏููุฉ ุงููููุฑุฉ", "ููุฉ ุงูููุฑูุฉ", "ุฏูุดู", "ุจุบุฏุงุฏ"],
        "correct": 0,
        "info": "ุงููุฏููุฉ ุงููููุฑุฉ (ูุซุฑุจ ุณุงุจูุงู) ูู ุฃูู ุนุงุตูุฉ ูููุณูููู ุจุนุฏ ุงููุฌุฑุฉ ุงููุจููุฉ."
    },
    {
        "q": "ุฃูู ููุน ุงููุณุฌุฏ ุงูุฃูุตูุ",
        "a": ["ุงููุฏููุฉ ุงููููุฑุฉ", "ุงููุฏุณ", "ููุฉ ุงูููุฑูุฉ", "ุงูุฎููู"],
        "correct": 1,
        "info": "ููุน ุงููุณุฌุฏ ุงูุฃูุตู ูู ุงูุจูุฏุฉ ุงููุฏููุฉ ุจุงููุฏุณ ุงูุดุฑููุ ููู ุฃููู ุงููุจูุชูู ูุซุงูุซ ุงูุญุฑููู."
    }
];
// ููุงูุฉ ูุตูููุฉ ุงูุฃุณุฆูุฉ ุงููุฏูุฌุฉ

// *** ุนูุงุตุฑ ุงููุงุฌูุฉ ูุงูุฃุตูุงุช ***
const quizContainer=document.getElementById('quiz'),
      result=document.getElementById('result'),
      nextButton=document.getElementById('next-btn'),
      progressFill=document.getElementById('progress-fill'),
      timerElement=document.getElementById('timer'),
      timerNumber=document.getElementById('timer-number');
      // ุชู ุฅุฒุงูุฉ loadingMessage ูุนุฏู ุงูุญุงุฌุฉ ุฅููู

const soundCorrect=document.getElementById('sound-correct'),
      soundWrong=document.getElementById('sound-wrong'),
      soundTimeUp=document.getElementById('sound-timeup');

const backgroundMusic=document.getElementById('background-music'),
      musicToggleButton=document.getElementById('music-toggle-btn'),
      musicIcon=document.getElementById('music-icon'),
      musicStatus=document.getElementById('music-status');
      
// ุนูุงุตุฑ ุดุงุดุฉ ุงูุชุฑุญูุจ ุงูุฌุฏูุฏุฉ
const welcomeScreen=document.getElementById('welcome-screen'), 
      startButton=document.getElementById('start-quiz-btn'); 
      
// ุนูุงุตุฑ ุดุงุดุฉ ุงูุฏุฎูู ูุงูุชุญุฏู ุงูุฌุฏูุฏุฉ
const playerNameInput = document.getElementById('player-name-input'),
      playerPassInput = document.getElementById('player-pass-input'),
      welcomeMessageText = document.getElementById('welcome-message-text'),
      loginForm = document.getElementById('login-form'),
      errorMessage = document.getElementById('error-message');
      
// ุนูุงุตุฑ ูุธุงู ุงููุณุงุนุฏุฉ
const fiftyFiftyButton = document.getElementById('fifty-fifty-btn'),
      fiftyFiftyCount = document.getElementById('fifty-fifty-count');

// *** ูุชุบูุฑุงุช ุญุงูุฉ ุงูุงุฎุชุจุงุฑ ***
let selectedQuestions=[], currentQuestionIndex=0, score=0, answered=false, questionTimer, questionCountdown;
let playerName = 'ุฒุงุฆุฑ'; 
let fiftyFiftyUses = 1; 

// *** 1. ุฌูุจ ุงูุฃุณุฆูุฉ (ุชุจุฏุฃ ูุจุงุดุฑุฉ) ***
function fetchQuestions() {
    // ุฅุนุงุฏุฉ ุชุนููู ุนุฏุฏ ุงุณุชุฎุฏุงูุงุช ุงููุณุงุนุฏุฉ ููู ุฌููุฉ ุฌุฏูุฏุฉ
    fiftyFiftyUses = 1; 
    fiftyFiftyCount.textContent = fiftyFiftyUses;
    fiftyFiftyButton.disabled = false;
    initializeQuestions();
}


// *** 2. ุชููุฆุฉ ูุงุฎุชูุงุฑ 10 ุฃุณุฆูุฉ ุนุดูุงุฆูุฉ ***
function initializeQuestions() {
    if(ALL_QUESTIONS.length < QUIZ_LENGTH){
        quizContainer.innerHTML = `<p class="text-red-500 text-xl mt-12">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ูุงููุฉ ูู ุงููุตูููุฉ.</p>`;
        return;
    }
    
    const seed = Math.floor(Math.random() * 1000000); 
    function seededShuffle(array, currentSeed) {
        let arr = [...array], i = arr.length, j, temp;
        while(i){
            j = (currentSeed + i) % i;
            i--;
            temp = arr[i];
            arr[i] = arr[j];
            arr[j] = temp;
        }
        return arr;
    }

    const shuffledQuestions = seededShuffle(ALL_QUESTIONS, seed);
    selectedQuestions = shuffledQuestions.slice(0, QUIZ_LENGTH).map((q, index) => {
        const answerSeed = seed * 10 + index; 
        const answers = q.a.map((text,i)=>({text,isCorrect:i===q.correct}));

        let ansArr=[...answers], c=ansArr.length, r, t;
        while(c){
            r=(answerSeed+c)%c;
            c--;
            t=ansArr[c];
            ansArr[c]=ansArr[r];
            ansArr[r]=t;
        }
        const newCorrectIndex = ansArr.findIndex(a=>a.isCorrect);
        return {
            q:q.q,
            a: ansArr.map(a=>a.text),
            correct: newCorrectIndex,
            info: q.info
        };
    });

    currentQuestionIndex=0; score=0;
    result.classList.add('hidden'); 
    timerElement.classList.remove('hidden');
    fiftyFiftyButton.classList.remove('hidden'); 
    startQuiz();
}

// *** 3. ุฏูุงู ุชุดุบูู ุงูุงุฎุชุจุงุฑ ***

function startQuiz(){loadQuestion();}

function loadQuestion(){
    clearInterval(questionTimer);
    nextButton.classList.add('hidden');
    answered=false;

    if(currentQuestionIndex>=selectedQuestions.length){
        showFinalResult();
        return;
    }

    const q = selectedQuestions[currentQuestionIndex];
    quizContainer.innerHTML = `
        <div class="question-card mt-6" style="opacity:1; transform:translateY(0);">
            <p class="text-xl md:text-2xl font-bold mb-6 text-yellow-100">ุงูุณุคุงู ${currentQuestionIndex+1} ูู ${QUIZ_LENGTH}</p>
            <h2 class="text-2xl md:text-3xl font-extrabold mb-8">${q.q}</h2>
            <div id="answers-container" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                ${q.a.map((answer,index)=>`<button class="answer-btn bg-emerald-700 text-white p-3 rounded-xl shadow-lg hover:bg-emerald-600" data-index="${index}">${answer}</button>`).join('')}
            </div>
            <div id="info-box" class="hidden text-sm mt-4"></div>
            <div class="timer-bar mt-6"><div id="timer-fill" class="timer-fill" style="transition:width ${TIME_PER_QUESTION}s linear;"></div></div>
        </div>
    `;
    document.querySelectorAll('.answer-btn').forEach(btn=>btn.addEventListener('click',checkAnswer));
    fiftyFiftyButton.disabled = fiftyFiftyUses <= 0 || answered;
    updateProgress();
    startQuestionTimer();
}

function useFiftyFifty() {
    if (answered || fiftyFiftyUses <= 0) return;

    fiftyFiftyUses--;
    fiftyFiftyCount.textContent = fiftyFiftyUses;
    fiftyFiftyButton.disabled = true;

    const q = selectedQuestions[currentQuestionIndex];
    const answers = document.querySelectorAll('.answer-btn');
    const wrongIndices = [];
    
    answers.forEach((btn, index) => {
        if (index !== q.correct) {
            wrongIndices.push(index);
        }
    });

    let eliminatedCount = 0;
    while (eliminatedCount < 2 && wrongIndices.length > 0) {
        const randomIndex = Math.floor(Math.random() * wrongIndices.length);
        const indexToEliminate = wrongIndices.splice(randomIndex, 1)[0];
        
        document.querySelector(`.answer-btn[data-index="${indexToEliminate}"]`).style.opacity = '0.3';
        document.querySelector(`.answer-btn[data-index="${indexToEliminate}"]`).style.pointerEvents = 'none';
        
        eliminatedCount++;
    }
}


function startQuestionTimer(){
    let timeLeft=TIME_PER_QUESTION;
    const timerFill=document.getElementById('timer-fill');
    timerNumber.textContent=timeLeft;
    questionCountdown=timeLeft;
    timerFill.style.width='100%';
    timerFill.style.transition=`width ${TIME_PER_QUESTION}s linear`;
    void timerFill.offsetWidth;
    questionTimer=setInterval(()=>{
        questionCountdown--;
        timerNumber.textContent=questionCountdown;
        if(questionCountdown<=0){clearInterval(questionTimer);handleTimeUp();}
    } ,1000);
}

function handleTimeUp(){
    if(!answered){
        soundTimeUp.play().catch(()=>{});
        answered=true;
        fiftyFiftyButton.disabled = true;
        const q=selectedQuestions[currentQuestionIndex];
        document.querySelector(`.answer-btn[data-index="${q.correct}"]`).classList.add('correct');
        const infoBox=document.getElementById('info-box');
        infoBox.innerHTML=`**โจ ูุนูููุฉ ุฅุถุงููุฉ:** ${q.info}`;
        infoBox.classList.remove('hidden');
        result.textContent='โ ุงูุชูู ุงูููุช! ูู ุชุญุตู ุนูู ููุทุฉ.';
        result.className='mt-6 text-2xl md:text-3xl font-bold p-4 rounded-xl shadow-2xl bg-red-800 text-white';
        result.classList.remove('hidden');
        nextButton.classList.remove('hidden');
    }
}

function checkAnswer(event){
    if(answered) return;
    answered=true;
    clearInterval(questionTimer);
    fiftyFiftyButton.disabled = true;
    const selectedButton=event.target;
    const selectedIndex=parseInt(selectedButton.dataset.index);
    const q=selectedQuestions[currentQuestionIndex];
    const isCorrect = selectedIndex===q.correct;
    const infoBox=document.getElementById('info-box');

    document.querySelectorAll('.answer-btn').forEach(btn=>{
        if(parseInt(btn.dataset.index)===q.correct) btn.classList.add('correct');
        else if(btn===selectedButton) btn.classList.add('wrong');
        btn.classList.add('answered');
    });

    infoBox.innerHTML=`**โจ ูุนูููุฉ ุฅุถุงููุฉ:** ${q.info}`;
    infoBox.classList.remove('hidden');

    if(isCorrect){score++; soundCorrect.play().catch(()=>{}); result.textContent='โ ุฅุฌุงุจุฉ ุตุญูุญุฉ!'; result.className='mt-6 text-2xl md:text-3xl font-bold p-4 rounded-xl shadow-2xl bg-green-800 text-white';}
    else{soundWrong.play().catch(()=>{}); result.textContent=`โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุงูุตุญูุญุฉ: ${q.a[q.correct]}`; result.className='mt-6 text-2xl md:text-3xl font-bold p-4 rounded-xl shadow-2xl bg-red-800 text-white';}

    result.classList.remove('hidden');
    nextButton.classList.remove('hidden');
}

function updateProgress(){
    const percentage=(currentQuestionIndex/QUIZ_LENGTH)*100;
    progressFill.style.width=`${percentage}%`;
}

function showFinalResult(){
    progressFill.style.width='100%';
    quizContainer.innerHTML='';
    fiftyFiftyButton.classList.add('hidden'); 

    let bestScore=parseInt(localStorage.getItem('bestScore')||'0'), isNewRecord=false;
    if(score>bestScore){bestScore=score; localStorage.setItem('bestScore',bestScore); isNewRecord=true;}

    const percentage=(score/selectedQuestions.length)*100;
    let message='';
    
    if(isNewRecord) message=`๐ ุฑูู ููุงุณู ุฌุฏูุฏ ูุง ${playerName}! ุชูุงูููุง! ๐ฏ`;
    else if(percentage===100) message=`ูุจุงุฑูุ ${playerName}! ๐ ุงูุฏุฑุฌุฉ ุงููุงููุฉ! ๐ฏ`;
    else if(percentage>=70) message=`ูุชูุฌุฉ ููุชุงุฒุฉ ูุง ${playerName}! โจ ${score} ูู ${selectedQuestions.length}.`;
    else message=`ูุชูุฌุชู ูุง ${playerName} ูู: ${score} ูู ${selectedQuestions.length}. ุชุญุชุงุฌ ุฅูู ูุฑุงุฌุนุฉ ุจุณูุทุฉ. ๐`;

    result.innerHTML=`<p class="text-3xl md:text-4xl mb-4">ุงูุชูู ุงูุงุฎุชุจุงุฑ!</p>
        <p class="text-xl md:text-2xl font-bold mb-4">${message}</p>
        <p class="text-lg mb-2">ูุณุจุฉ ุงููุฌุงุญ: ${percentage.toFixed(2)}%</p>
        <p class="text-yellow-300 text-lg font-bold mb-4">ุฃุนูู ูุชูุฌุฉ ูุฏูู: ${bestScore} ูู ${selectedQuestions.length}</p>
        <button onclick="fetchQuestions()" class="mt-4 bg-yellow-500 hover:bg-yellow-400 text-gray-900 font-bold py-2 px-4 rounded-full text-lg transition">ุงุจุฏุฃ ุงุฎุชุจุงุฑ ุฌุฏูุฏ</button>`;

    result.classList.remove('hidden');
    nextButton.classList.add('hidden'); 
    timerElement.classList.add('hidden');
}


// *** 4. ูุธููุฉ ุชุดุบูู ุงูููุณููู/ุฅููุงููุง ***
function toggleMusic(){
    if(backgroundMusic.paused){
        backgroundMusic.play().catch(()=>{
             console.log('Music autoplay failed.');
        });
        musicIcon.textContent='๐ต'; 
        musicStatus.textContent='ุฅููุงู';
    }
    else{backgroundMusic.pause(); musicIcon.textContent='๐'; musicStatus.textContent='ุชุดุบูู';}
}

// ุฏุงูุฉ ุงูุชุญูู ูู ุงูุชุฎุฒูู ุงููุญูู ูุงูุชุฑุญูุจ
function checkLocalStorage() {
    const savedName = localStorage.getItem('playerName');
    
    if (savedName) {
        playerName = savedName; 
        
        welcomeMessageText.textContent = `ุฃููุงู ุจุนูุฏุชูุ ${playerName}!`;
        
        playerNameInput.value = savedName;
        playerPassInput.classList.add('hidden'); 
        errorMessage.classList.add('hidden');
        
    } else {
        welcomeMessageText.textContent = 'ุฃููุงู ุจู ูู ุชุญุฏู ุงููุนุฑูุฉ ุงูุฅุณูุงููุฉ!';
        playerPassInput.classList.remove('hidden');
    }
}

// *** 5. ูุนุงูุฌุงุช ุงูุฃุญุฏุงุซ ูุงูุจุฏุก ***
musicToggleButton.addEventListener('click',toggleMusic);
fiftyFiftyButton.addEventListener('click', useFiftyFifty); 

nextButton.addEventListener('click',()=>{
    if(currentQuestionIndex>=selectedQuestions.length){
        fetchQuestions(); 
        nextButton.textContent='ุงูุณุคุงู ุงูุชุงูู โก๏ธ';
    }
    else{
        currentQuestionIndex++; 
        result.classList.add('hidden'); 
        loadQuestion();
    }
});

// ุชุดุบูู ุงูุงุฎุชุจุงุฑ ุจุนุฏ ุงูููุฑ ุนูู ุฒุฑ ุงูุจุฏุก
startButton.addEventListener('click', () => {
    const name = playerNameInput.value.trim();
    const password = playerPassInput.value.trim();
    
    if (name === '') {
        errorMessage.textContent = 'ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณู ุงููุงุนุจ.';
        errorMessage.classList.remove('hidden');
        return;
    }
    
    // ๐ฅ ุชู ุชุนุฏูู ูุฐุง ุงูุดุฑุท: ูุณูุญ ุจูููุฉ ูุฑูุฑ ูุงุฑุบุฉ ุฃู ุตุญูุญุฉ (1234)
    if (password !== '' && password !== '1234') {
        errorMessage.textContent = 'ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ (ุงุณุชุฎุฏู 1234 ุฅุฐุง ุฃุฑุฏุช).';
        errorMessage.classList.remove('hidden');
        return;
    }
    
    playerName = name;
    localStorage.setItem('playerName', name);
    
    // ุงูุงูุชูุงู ุงูููุฑู ุจุฏูู ุงูุชุธุงุฑ ุชุญููู
    welcomeScreen.classList.add('hidden'); 
    
    backgroundMusic.play().catch(() => {
        console.log("Music play requested by user click.");
    });
    
    fetchQuestions();
});

document.addEventListener('DOMContentLoaded', () => {
    checkLocalStorage(); 
    backgroundMusic.play().catch(() => {
        console.log("Autoplay failed.");
    });
});
</script>
</body>
</html>
