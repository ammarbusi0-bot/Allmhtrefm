<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة التحدي الشاملة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /*
        ==================================================
        التصميم الفخم (CSS)
        ==================================================
        */
        :root {
            --primary-color: #38a169;
            --dark-bg: #1e1e1e;
            --light-text: #f0f0f0;
            --secondary-color: #5a5a5a;
            --error-color: #ff4d4d;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--dark-bg);
            color: var(--light-text);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: right;
        }

        .container {
            background-color: #2b2b2b;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            width: 90%;
            max-width: 450px;
            direction: rtl;
        }

        h1, h2, h3 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
        }

        /* تنسيق حقول الإدخال */
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid var(--secondary-color);
            background-color: #3a3a3a;
            color: var(--light-text);
            border-radius: 8px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }

        /* الأزرار الرئيسية */
        .primary-button {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: var(--dark-bg);
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            margin-bottom: 10px;
        }

        .primary-button:hover {
            background-color: #2f855a;
            transform: translateY(-2px);
        }

        .description {
            font-size: 0.85em;
            color: #ccc;
            margin-top: -10px;
            margin-bottom: 25px;
            padding: 5px 0;
            border-top: 1px solid #3a3a3a;
            padding-top: 15px;
        }

        #login-message {
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
            padding: 10px;
            border-radius: 5px;
        }

        .links-section {
            display: none;
            padding-top: 10px;
        }

        .welcome-message {
            font-size: 1.2em;
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            border-bottom: 2px solid var(--primary-color);
        }

        /* تنسيقات الأزرار الفخمة (الروابط) */
        .fancy-button {
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            padding: 15px 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            color: var(--light-text);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        .fancy-button i { margin-left: 10px; }
        .whatsapp-button { background: #25d366; }
        .telegram-button { background: #0088cc; }
        .tiktok-button { background: #000000; border: 2px solid #fe2c55; }
        .logout-button { background-color: #8B0000; margin-top: 20px; }

        /* تنسيق أقسام اللعب */
        .game-mode-selection {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 10px;
        }
        .game-mode-selection button {
             width: 48%;
             font-size: 1em;
             padding: 15px;
        }

        /* تنسيقات شاشة الاختبار (الجديدة) */
        .quiz-section {
            background-color: #333;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border: 1px solid var(--primary-color);
        }
        .score-display {
            font-size: 1.1em;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            background-color: #4a4a4a;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        #timer-display {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            padding: 10px;
            color: var(--error-color);
            background-color: #1a1a1a;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 2px solid var(--error-color);
        }

        .question-text {
            font-size: 1.3em;
            margin-bottom: 25px;
            padding: 10px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        .true-false-options {
            display: flex;
            justify-content: space-around;
            gap: 15px;
        }

        .option-btn {
            background-color: #4a4a4a;
            color: var(--light-text);
            border: none;
            padding: 15px;
            text-align: center;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            width: 100%;
        }
        .option-btn:hover:not(.disabled) {
            background-color: #5a5a5a;
        }
        .option-btn.correct {
            background-color: #2f855a !important; /* أخضر للإجابة الصحيحة */
        }
        .option-btn.incorrect {
            background-color: var(--error-color) !important; /* أحمر للإجابة الخاطئة */
        }
        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.8;
        }

        #next-btn, #restart-btn {
            margin-top: 25px;
            display: none;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen">
        <h1>تسجيل الدخول إلى المنصة</h1>
        <form id="login-form">
            <div class="form-group"><input type="text" id="username" placeholder="اسم المستخدم (أي اسم تختاره)" required></div>
            <div class="form-group">
                <input type="password" id="password" placeholder="كلمة المرور (أي كود سري تختاره)" required>
                <div class="description">
                    <p>إذا كانت هذه أول زيارة لك، فسيقوم النظام **بتسجيل بيانات الدخول وحفظها** على جهازك تلقائياً لتمكينك من العودة لاحقاً ومتابعة نتائجك.</p>
                </div>
            </div>
            <button type="submit" class="primary-button" id="submit-button">تسجيل الدخول</button>
        </form>
        <p id="login-message" style="display:none;"></p>
    </div>

    <div id="links-selection-screen" class="hidden">
        <div class="welcome-message">
            <span id="greeting-text">أهلاً بك!</span> هذه صفحتك الخاصة.
        </div>
        
        <h2>روابطنا الخاصة</h2>
        <a href="https://wa.me/905510651347" class="fancy-button whatsapp-button" target="_blank">
            <i class="fab fa-whatsapp"></i> تواصل حصريًا عبر WhatsApp
        </a>
        <a href="https://t.me/bootcadid" class="fancy-button telegram-button" target="_blank">
            <i class="fab fa-telegram-plane"></i> قناتنا الخاصة على Telegram
        </a>
        <a href="https://www.tiktok.com/@allmhtref" class="fancy-button tiktok-button" target="_blank">
            <i class="fab fa-tiktok"></i> شاهد محتوانا الفخم على TikTok
        </a>

        <div class="quiz-section">
            <h3>نتائجك واختيار اللعب</h3>
            <p id="last-score-mc" class="score-display">اختيار من متعدد: لا نتيجة بعد.</p>
            <p id="last-score-tf" class="score-display">صح وخطأ: لا نتيجة بعد.</p>

            <p style="text-align: center; font-weight: bold; margin-top: 20px;">ابدأ تحدي جديد:</p>
            <div class="game-mode-selection">
                <button onclick="startNewGame('mc_quiz')" class="primary-button">اختيار من متعدد (50 سؤال)</button>
                <button onclick="startNewGame('tf_quiz')" class="primary-button">صح وخطأ (50 سؤال)</button>
            </div>
        </div>
        
        <button onclick="logout()" class="primary-button logout-button">تسجيل الخروج</button>
    </div>

    <div id="game-screen" class="hidden quiz-section">
        <h2 id="quiz-title"></h2>
        
        <div id="timer-display">15</div>

        <p style="font-weight: bold;">
            <span id="question-counter">السؤال 1 من 50</span>
        </p>
        
        <p class="question-text" id="question-text"></p>
        
        <div id="options-container">
            </div>

        <button id="next-btn" class="primary-button hidden" onclick="nextQuestion()">السؤال التالي</button>
    </div>

    <div id="finish-screen" class="hidden quiz-section">
        <h2>انتهى التحدي!</h2>
        <div id="results-display" class="score-display"></div>
        <button id="restart-btn" class="primary-button" onclick="resetGame()">العودة للصفحة الرئيسية</button>
    </div>
</div>

<script>
    // =======================================================
    // الثوابت وبيانات التخزين
    // =======================================================
    const TIME_LIMIT_SECONDS = 15; // 15 ثانية لكل سؤال
    const NUM_QUESTIONS = 50;

    // مفاتيح التخزين المحلي
    const USERNAME_KEY = 'user_username';
    const PASSWORD_KEY = 'user_password';
    const IS_LOGGED_IN = 'is_logged_in';
    const SCORES_KEY = 'user_scores'; // لحفظ جميع النتائج

    // العناصر الأساسية
    const loginScreen = document.getElementById('login-screen');
    const linksSelectionScreen = document.getElementById('links-selection-screen');
    const gameScreen = document.getElementById('game-screen');
    const finishScreen = document.getElementById('finish-screen');
    const greetingElement = document.getElementById('greeting-text');
    const submitButton = document.getElementById('submit-button');
    const loginMessage = document.getElementById('login-message');
    const lastScoreMC = document.getElementById('last-score-mc');
    const lastScoreTF = document.getElementById('last-score-tf');
    const timerDisplay = document.getElementById('timer-display');
    const optionsContainer = document.getElementById('options-container');

    // متغيرات حالة الاختبار
    let currentQuizData = [];
    let currentQuestionIndex = 0;
    let currentScore = 0;
    let timerInterval = null;
    let quizMode = ''; // 'mc_quiz' or 'tf_quiz'
    let currentUsername = '';

    // =======================================================
    // بيانات الأسئلة (50 سؤال لكل نمط)
    // (تم تركها كما هي لضمان اكتمال الـ 50 سؤال لكل نوع)
    // =======================================================
    
    // إنشاء 50 سؤال للاختيار من متعدد
    const mcQuestions = [];
    for (let i = 1; i <= NUM_QUESTIONS; i++) {
        mcQuestions.push({
            id: `mc${i}`,
            question: `سؤال الاختيار من متعدد رقم ${i}: ما هي عاصمة المملكة العربية السعودية؟`,
            options: {
                A: `الخيار أ (غير صحيح)`,
                B: `الرياض`, // الجواب الصحيح
                C: `الخيار ج (غير صحيح)`
            },
            correctAnswer: 'B'
        });
    }

    // إنشاء 50 سؤال للصح والخطأ
    const tfQuestions = [];
    for (let i = 1; i <= NUM_QUESTIONS; i++) {
        const isTrue = i % 2 === 0;
        tfQuestions.push({
            id: `tf${i}`,
            question: `سؤال الصح/الخطأ رقم ${i}: هل تتكون جزيئات الماء من ذرتي هيدروجين وذرة أكسجين؟`,
            correctAnswer: 'صحيح' 
        });
        if (!isTrue) {
             tfQuestions[i-1].question = `سؤال الصح/الخطأ رقم ${i}: هل القطب الشمالي هو موطن لطيور البطريق؟`;
             tfQuestions[i-1].correctAnswer = 'خطأ';
        }
    }


    // =======================================================
    // وظائف تسجيل الدخول والتخزين المحلي (تم تعديل هذا القسم)
    // =======================================================

    /**
     * وظيفة لعرض شاشة الروابط واختيار اللعب
     */
    function showLinksSelectionScreen(username) {
        currentUsername = username;
        loginScreen.classList.add('hidden');
        gameScreen.classList.add('hidden');
        finishScreen.classList.add('hidden');
        linksSelectionScreen.classList.remove('hidden');
        
        greetingElement.textContent = `أهلاً بك يا ${username}!`;
        displayLastScores(username); 
    }

    /**
     * عرض آخر نتيجة مسجلة للمستخدم لكل نمط
     */
    function displayLastScores(username) {
        const scores = JSON.parse(localStorage.getItem(SCORES_KEY)) || {};
        
        const lastScoreMCValue = scores[username]?.mc_quiz;
        if (lastScoreMCValue !== undefined) {
            lastScoreMC.textContent = `اختيار من متعدد: ${lastScoreMCValue} / ${NUM_QUESTIONS}`;
            lastScoreMC.style.backgroundColor = '#2f855a';
        } else {
            lastScoreMC.textContent = `اختيار من متعدد: لا نتيجة بعد.`;
            lastScoreMC.style.backgroundColor = '#4a4a4a';
        }

        const lastScoreTFValue = scores[username]?.tf_quiz;
        if (lastScoreTFValue !== undefined) {
            lastScoreTF.textContent = `صح وخطأ: ${lastScoreTFValue} / ${NUM_QUESTIONS}`;
            lastScoreTF.style.backgroundColor = '#2f855a';
        } else {
            lastScoreTF.textContent = `صح وخطأ: لا نتيجة بعد.`;
            lastScoreTF.style.backgroundColor = '#4a4a4a';
        }
    }

    /**
     * وظيفة تسجيل الخروج
     */
    window.logout = function() {
        localStorage.removeItem(IS_LOGGED_IN);
        location.reload(); 
    }

    // معالج حدث تسجيل الدخول/التسجيل (تم تعديل المنطق هنا)
    document.getElementById('login-form').addEventListener('submit', function(event) {
        event.preventDefault();

        const enteredUsername = document.getElementById('username').value.trim();
        const enteredPassword = document.getElementById('password').value.trim();
        
        // جلب البيانات المسجلة سابقاً
        const savedUsername = localStorage.getItem(USERNAME_KEY);
        const savedPassword = localStorage.getItem(PASSWORD_KEY);

        let success = false;
        let actionMessage = '';

        // 1. إذا كانت هناك بيانات مسجلة مسبقاً لهذا الجهاز
        if (savedUsername) {
            if (enteredUsername === savedUsername && enteredPassword === savedPassword) {
                // بيانات صحيحة - تسجيل دخول
                success = true;
                actionMessage = 'تم تسجيل الدخول بنجاح. جاري التحميل...';
            } else {
                // بيانات خاطئة - خطأ
                loginMessage.textContent = 'خطأ: اسم المستخدم أو كلمة المرور غير صحيحة.';
                loginMessage.style.backgroundColor = 'var(--error-color)';
                loginMessage.style.display = 'block';
            }
        } else {
            // 2. لا توجد بيانات مسجلة - إنشاء حساب جديد وحفظه تلقائياً
            localStorage.setItem(USERNAME_KEY, enteredUsername);
            localStorage.setItem(PASSWORD_KEY, enteredPassword);
            
            success = true;
            actionMessage = `تم حفظ بيانات الدخول تلقائياً. جاري التحميل...`;
        }

        if (success) {
            loginMessage.textContent = actionMessage;
            loginMessage.style.backgroundColor = '#2f855a';
            loginMessage.style.color = 'white';
            loginMessage.style.display = 'block';

            // تعيين حالة الدخول
            localStorage.setItem(IS_LOGGED_IN, 'true');
            
            setTimeout(() => {
                showLinksSelectionScreen(enteredUsername);
            }, 1000); 
        }
    });

    // =======================================================
    // وظائف الاختبار (لم يتم تعديلها - المؤقت والأنماط سليمة)
    // =======================================================

    /**
     * بدء لعبة جديدة (MC أو TF)
     */
    window.startNewGame = function(mode) {
        quizMode = mode;
        currentQuestionIndex = 0;
        currentScore = 0;

        if (mode === 'mc_quiz') {
            currentQuizData = mcQuestions;
            document.getElementById('quiz-title').textContent = 'تحدي الاختيار من متعدد';
        } else {
            currentQuizData = tfQuestions;
            document.getElementById('quiz-title').textContent = 'تحدي الصح والخطأ';
        }

        linksSelectionScreen.classList.add('hidden');
        gameScreen.classList.remove('hidden');
        
        loadQuestion();
        startTimer();
    }
    
    /**
     * تحميل وعرض السؤال الحالي
     */
    function loadQuestion() {
        document.getElementById('next-btn').classList.add('hidden');
        const questionData = currentQuizData[currentQuestionIndex];
        
        document.getElementById('question-counter').textContent = `السؤال ${currentQuestionIndex + 1} من ${NUM_QUESTIONS}`;
        document.getElementById('question-text').textContent = questionData.question;
        
        optionsContainer.innerHTML = '';
        
        if (quizMode === 'tf_quiz') {
            optionsContainer.classList.remove('options-grid');
            optionsContainer.classList.add('true-false-options');
            ['صحيح', 'خطأ'].forEach(optionText => {
                const btn = document.createElement('button');
                btn.classList.add('option-btn');
                btn.textContent = optionText;
                btn.onclick = () => checkAnswer(optionText, btn);
                optionsContainer.appendChild(btn);
            });
        } else { 
            optionsContainer.classList.add('options-grid');
            optionsContainer.classList.remove('true-false-options');
            for (const key in questionData.options) {
                const btn = document.createElement('button');
                btn.classList.add('option-btn');
                btn.textContent = `${key}. ${questionData.options[key]}`;
                btn.onclick = () => checkAnswer(key, btn);
                optionsContainer.appendChild(btn);
            }
        }
        
        resetTimer();
    }

    /**
     * التحقق من الإجابة المختارة
     */
    function checkAnswer(selectedAnswer, clickedButton) {
        stopTimer();
        const questionData = currentQuizData[currentQuestionIndex];
        const correctAnswer = questionData.correctAnswer;
        
        const allButtons = document.querySelectorAll('#options-container button');
        allButtons.forEach(btn => {
            btn.classList.add('disabled');
            let keyOrText;
            
            if (quizMode === 'mc_quiz') {
                keyOrText = btn.textContent.split('.')[0].trim();
            } else {
                keyOrText = btn.textContent.trim();
            }

            if (keyOrText === correctAnswer) {
                btn.classList.add('correct');
            } else if (btn === clickedButton) {
                btn.classList.add('incorrect');
            }
        });

        if (selectedAnswer === correctAnswer) {
            currentScore++;
        }

        document.getElementById('next-btn').classList.remove('hidden');
    }

    /**
     * الانتقال إلى السؤال التالي أو إنهاء اللعبة
     */
    window.nextQuestion = function() {
        currentQuestionIndex++;
        if (currentQuestionIndex < NUM_QUESTIONS) {
            loadQuestion();
            startTimer();
        } else {
            finishGame();
        }
    }

    /**
     * إنهاء اللعبة وحفظ النتيجة
     */
    function finishGame() {
        gameScreen.classList.add('hidden');
        finishScreen.classList.remove('hidden');
        
        // حفظ النتيجة
        const scores = JSON.parse(localStorage.getItem(SCORES_KEY)) || {};
        if (!scores[currentUsername]) {
            scores[currentUsername] = {};
        }
        scores[currentUsername][quizMode] = currentScore;
        localStorage.setItem(SCORES_KEY, JSON.stringify(scores));

        // عرض النتيجة
        const modeText = quizMode === 'mc_quiz' ? 'اختيار من متعدد' : 'صح وخطأ';
        document.getElementById('results-display').innerHTML = `
            <p>نمط اللعب: <strong>${modeText}</strong></p>
            <p>نتيجتك النهائية هي: <strong>${currentScore} من ${NUM_QUESTIONS}</strong></p>
        `;
    }
    
    /**
     * إعادة ضبط اللعبة والعودة إلى شاشة الروابط
     */
    window.resetGame = function() {
        finishScreen.classList.add('hidden');
        // إعادة عرض شاشة الروابط مع تحديث النتيجة الجديدة
        showLinksSelectionScreen(currentUsername); 
    }

    // =======================================================
    // وظائف المؤقت
    // =======================================================
    
    /**
     * بدء المؤقت التنازلي
     */
    function startTimer() {
        let timeLeft = TIME_LIMIT_SECONDS;
        timerDisplay.textContent = timeLeft;

        timerInterval = setInterval(() => {
            timeLeft--;
            timerDisplay.textContent = timeLeft;
            
            if (timeLeft <= 0) {
                stopTimer();
                // إذا انتهى الوقت ولم يختر المستخدم، اعتبر الإجابة خاطئة
                checkAnswer(null, null); 
            }
        }, 1000);
    }

    /**
     * إيقاف المؤقت
     */
    function stopTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
    }

    /**
     * إعادة ضبط المؤقت
     */
    function resetTimer() {
        stopTimer();
        timerDisplay.textContent = TIME_LIMIT_SECONDS;
    }

    // =======================================================
    // تهيئة الصفحة عند التحميل
    // =======================================================
    document.addEventListener('DOMContentLoaded', function() {
        const savedUsername = localStorage.getItem(USERNAME_KEY);
        
        // 1. التحقق من حالة الدخول عند تحميل الصفحة
        if (localStorage.getItem(IS_LOGGED_IN) === 'true' && savedUsername) {
            showLinksSelectionScreen(savedUsername);
        } else {
            loginScreen.classList.remove('hidden');
             // تحديث نص الزر إذا كانت البيانات محفوظة
            if (savedUsername) {
                 submitButton.textContent = 'تسجيل الدخول';
            } else {
                 submitButton.textContent = 'تسجيل الدخول (سجل بياناتك)';
            }
        }
    });
</script>

</body>
</html>
